<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ===== –°–ë–†–û–° –ò –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò ===== */
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        body {
          font-family: 'Arial', sans-serif;
          line-height: 1.6;
          background: #0f1421;
          color: #ffffff;
          transition: all 0.3s ease;
        }

        /* ===== –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –¢–ï–ú ===== */
        [data-theme="light"] {
          --bg-primary: #ffffff;
          --bg-secondary: #f8f9fa;
          --bg-card: #ffffff;
          --text-primary: #333333;
          --text-secondary: #666666;
          --border-color: #e1e5e9;
          --accent-color: #2962ff;
          --positive-color: #00c853;
          --negative-color: #ff1744;
          --shadow: 0 2px 10px rgba(0,0,0,0.1);
          --shadow-hover: 0 4px 20px rgba(0,0,0,0.15);
          --table-header-bg: #f8f9fa;
          --table-row-even: #ffffff;
          --table-row-odd: #f8f9fa;
          --table-hover: #e3f2fd;
        }

        [data-theme="dark"] {
          --bg-primary: #0f1421;
          --bg-secondary: #1a1f2e;
          --bg-card: #1a1f2e;
          --text-primary: #ffffff;
          --text-secondary: #b0b7c3;
          --border-color: #2a2f3e;
          --accent-color: #2962ff;
          --positive-color: #00c853;
          --negative-color: #ff1744;
          --shadow: 0 2px 10px rgba(0,0,0,0.3);
          --shadow-hover: 0 4px 20px rgba(0,0,0,0.4);
          --table-header-bg: #2a2f3e;
          --table-row-even: #1a1f2e;
          --table-row-odd: #151a28;
          --table-hover: #2a2f3e;
        }

        /* ===== –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –¢–ï–ú–´ ===== */
        body {
          background-color: var(--bg-primary);
          color: var(--text-primary);
        }

        /* ===== –ö–û–ù–¢–ï–ô–ù–ï–†–´ ===== */
        .container {
          max-width: 1400px;
          margin: 0 auto;
          padding: 0 20px;
        }

        /* ===== HEADER ===== */
        .site-header {
          background: var(--bg-secondary);
          border-bottom: 1px solid var(--border-color);
          padding: 15px 0;
          position: sticky;
          top: 0;
          z-index: 1000;
        }

        .header-content {
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .logo {
          font-size: 24px;
          font-weight: bold;
          color: var(--accent-color);
        }

        /* ===== –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø ===== */
        .control-panel {
          display: flex;
          align-items: center;
          gap: 20px;
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ */
        .lang-switcher {
          display: flex;
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 4px;
        }

        .lang-btn {
          padding: 6px 12px;
          border: none;
          background: none;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          transition: all 0.3s ease;
        }

        .lang-btn.active {
          background: var(--accent-color);
          color: white;
        }

        .lang-btn:hover:not(.active) {
          background: var(--bg-secondary);
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
        .theme-control {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .theme-label {
          font-size: 14px;
          color: var(--text-secondary);
        }

        .theme-switch {
          position: relative;
          display: inline-block;
          width: 50px;
          height: 24px;
        }

        .theme-switch input {
          opacity: 0;
          width: 0;
          height: 0;
        }

        .theme-slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: #ccc;
          transition: .4s;
          border-radius: 24px;
        }

        .theme-slider:before {
          position: absolute;
          content: "";
          height: 16px;
          width: 16px;
          left: 4px;
          bottom: 4px;
          background-color: white;
          transition: .4s;
          border-radius: 50%;
        }

        input:checked + .theme-slider {
          background-color: var(--accent-color);
        }

        input:checked + .theme-slider:before {
          transform: translateX(26px);
        }

        /* ===== –ü–û–ò–°–ö –í HEADER ===== */
        .header-search {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .search-wrapper {
          position: relative;
          display: flex;
          align-items: center;
        }

        .search-input {
          width: 300px;
          padding: 10px 40px 10px 15px;
          border: 1px solid var(--border-color);
          border-radius: 20px;
          background: var(--bg-card);
          color: var(--text-primary);
          font-size: 14px;
          transition: all 0.3s ease;
          outline: none;
        }

        .search-input:focus {
          border-color: var(--accent-color);
          box-shadow: 0 0 0 2px rgba(41, 98, 255, 0.1);
          width: 350px;
        }

        .search-input::placeholder {
          color: var(--text-secondary);
        }

        .search-icon {
          position: absolute;
          right: 12px;
          top: 50%;
          transform: translateY(-50%);
          color: var(--text-secondary);
          pointer-events: none;
        }

        .search-clear {
          position: absolute;
          right: 35px;
          background: none;
          border: none;
          font-size: 1.2rem;
          color: var(--text-secondary);
          cursor: pointer;
          padding: 2px;
          border-radius: 50%;
          transition: all 0.2s ease;
          display: none;
        }

        .search-clear:hover {
          background: var(--bg-secondary);
          color: var(--text-primary);
        }

        .search-clear.visible {
          display: block;
        }

        /* ===== –°–ï–ö–¶–ò–Ø –ú–û–ù–ï–¢ ===== */
        .section {
          padding: 20px 0;
        }

        .section-title {
          font-size: 28px;
          margin-bottom: 20px;
          color: var(--text-primary);
        }

        /* ===== FEAR & GREED INDEX ===== */
        .fear-greed-widget {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 12px;
          padding: 20px;
          margin: 20px 0;
          box-shadow: var(--shadow);
        }

        .fear-greed-title {
          font-size: 20px;
          margin-bottom: 20px;
          color: var(--text-primary);
          font-weight: 600;
        }

        .fear-greed-container {
          display: grid;
          grid-template-columns: 2fr 1fr;
          gap: 20px;
          align-items: start;
        }

        .fear-greed-scale {
          display: flex;
          flex-direction: column;
          gap: 10px;
        }

        .scale-labels {
          display: flex;
          justify-content: space-between;
          font-size: 11px;
          color: var(--text-secondary);
          font-weight: 500;
        }

        .scale-bar {
          position: relative;
          height: 24px;
          background: var(--bg-secondary);
          border-radius: 12px;
          overflow: hidden;
        }

        .scale-gradient {
          display: flex;
          height: 100%;
          width: 100%;
        }

        .scale-segment {
          flex: 1;
          height: 100%;
        }

        .extreme-fear { background: linear-gradient(90deg, #dc2626, #ef4444); }
        .fear { background: #f59e0b; }
        .neutral { background: #eab308; }
        .greed { background: #84cc16; }
        .extreme-greed { background: linear-gradient(90deg, #16a34a, #22c55e); }

        .fear-greed-indicator {
          position: absolute;
          top: -4px;
          transform: translateX(-50%);
          z-index: 10;
        }

        .indicator-arrow {
          width: 0;
          height: 0;
          border-left: 6px solid transparent;
          border-right: 6px solid transparent;
          border-bottom: 8px solid var(--accent-color);
          margin: 0 auto;
        }

        .indicator-line {
          width: 2px;
          height: 28px;
          background: var(--accent-color);
          margin: 0 auto;
        }

        .scale-states {
          display: flex;
          justify-content: space-between;
          font-size: 10px;
          color: var(--text-secondary);
          text-align: center;
        }

        .fear-greed-info {
          display: flex;
          flex-direction: column;
          gap: 15px;
          padding: 15px;
          background: var(--bg-secondary);
          border-radius: 8px;
        }

        .current-value, .current-state {
          text-align: center;
        }

        .value-number {
          display: block;
          font-size: 24px;
          font-weight: bold;
          color: var(--accent-color);
        }

        .state-text {
          display: block;
          font-size: 16px;
          font-weight: 600;
          color: var(--text-primary);
        }

        .value-label, .state-label {
          display: block;
          font-size: 11px;
          color: var(--text-secondary);
          margin-top: 4px;
        }

        /* ===== –¢–ê–ë–õ–ò–¶–ê –ú–û–ù–ï–¢ ===== */
        .coins-table-container {
          background: var(--bg-card);
          border-radius: 12px;
          border: 1px solid var(--border-color);
          overflow: hidden;
          box-shadow: var(--shadow);
          overflow-x: auto;
        }

        .coins-table {
          width: 100%;
          border-collapse: collapse;
          min-width: 800px;
        }

        .coins-table th {
          background: var(--table-header-bg);
          padding: 15px 12px;
          text-align: left;
          font-weight: 600;
          font-size: 14px;
          color: var(--text-secondary);
          border-bottom: 1px solid var(--border-color);
          cursor: pointer;
          transition: background-color 0.2s ease;
          user-select: none;
          white-space: nowrap;
        }

        .coins-table th:hover {
          background: var(--table-hover);
        }

        .coins-table th.sort-asc::after {
          content: " ‚Üë";
          color: var(--accent-color);
        }

        .coins-table th.sort-desc::after {
          content: " ‚Üì";
          color: var(--accent-color);
        }

        .coins-table td {
          padding: 15px 12px;
          border-bottom: 1px solid var(--border-color);
          font-size: 14px;
          white-space: nowrap;
        }

        .coins-table tbody tr:nth-child(even) {
          background: var(--table-row-even);
        }

        .coins-table tbody tr:nth-child(odd) {
          background: var(--table-row-odd);
        }

        .coins-table tbody tr:hover {
          background: var(--table-hover);
        }

        .coins-table tbody tr:last-child td {
          border-bottom: none;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫ —Ç–∞–±–ª–∏—Ü—ã */
        .coin-rank {
          width: 60px;
          text-align: center;
          font-weight: 600;
          color: var(--text-secondary);
        }

        .coin-info {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .coin-icon {
          width: 32px;
          height: 32px;
          border-radius: 50%;
          object-fit: cover;
        }

        .coin-name-symbol {
          display: flex;
          flex-direction: column;
        }

        .coin-name {
          font-weight: 600;
          color: var(--text-primary);
        }

        .coin-symbol {
          font-size: 12px;
          color: var(--text-secondary);
          text-transform: uppercase;
        }

        .coin-price {
          font-weight: 600;
          color: var(--text-primary);
        }

        .coin-change {
          font-weight: 600;
          padding: 4px 8px;
          border-radius: 4px;
          text-align: center;
        }

        .change-positive {
          background: rgba(0, 200, 83, 0.1);
          color: var(--positive-color);
        }

        .change-negative {
          background: rgba(255, 23, 68, 0.1);
          color: var(--negative-color);
        }

        .coin-market-cap, .coin-volume {
          color: var(--text-primary);
        }

        .coin-sparkline {
          width: 120px;
          height: 40px;
        }

        .coin-actions {
          display: flex;
          gap: 8px;
        }

        .action-btn {
          padding: 6px 12px;
          background: var(--accent-color);
          color: white;
          text-decoration: none;
          border-radius: 4px;
          font-size: 12px;
          transition: all 0.2s ease;
          border: none;
          cursor: pointer;
          white-space: nowrap;
        }

        .action-btn:hover {
          background: #1e40af;
          transform: translateY(-1px);
        }

        /* ===== –ü–ê–ì–ò–ù–ê–¶–ò–Ø ===== */
        .pagination {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 15px;
          margin-top: 20px;
          padding: 20px;
        }

        .page-btn {
          padding: 10px 16px;
          border: 1px solid var(--border-color);
          background: var(--bg-card);
          color: var(--text-primary);
          border-radius: 6px;
          cursor: pointer;
          transition: all 0.2s ease;
        }

        .page-btn:hover:not(.disabled) {
          background: var(--accent-color);
          color: white;
          border-color: var(--accent-color);
        }

        .page-btn.disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .page-info {
          color: var(--text-secondary);
          font-size: 14px;
        }

        /* ===== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ===== */
        @media (max-width: 1200px) {
          .container {
            padding: 0 15px;
          }
          
          .search-input {
            width: 250px;
          }
          
          .search-input:focus {
            width: 300px;
          }
        }

        @media (max-width: 768px) {
          .header-content {
            flex-direction: column;
            gap: 15px;
          }
          
          .control-panel {
            width: 100%;
            justify-content: space-between;
          }
          
          .header-search {
            width: 100%;
          }
          
          .search-input {
            width: 100%;
          }
          
          .search-input:focus {
            width: 100%;
          }
          
          .fear-greed-container {
            grid-template-columns: 1fr;
            gap: 15px;
          }
          
          .coins-table {
            font-size: 12px;
          }
          
          .coins-table th,
          .coins-table td {
            padding: 10px 8px;
          }
          
          .coin-actions {
            flex-direction: column;
            gap: 4px;
          }
          
          .action-btn {
            padding: 4px 8px;
            font-size: 10px;
          }
        }

        /* ===== LOADING STATES ===== */
        .loading {
          opacity: 0.6;
          pointer-events: none;
        }

        .skeleton {
          background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border-color) 50%, var(--bg-secondary) 75%);
          background-size: 200% 100%;
          animation: loading 1.5s infinite;
          border-radius: 4px;
        }

        @keyframes loading {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }
    </style>
</head>
<body data-theme="dark">
    <!-- HEADER –° –ü–û–ò–°–ö–û–ú -->
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <div class="logo" id="siteLogo">CryptoDrom</div>
                
                <div class="control-panel">
                    <!-- –ü–æ–∏—Å–∫ –≤ header -->
                    <div class="header-search">
                        <div class="search-wrapper">
                            <input type="text" class="search-input" id="mainSearch" placeholder="–ü–æ–∏—Å–∫ –º–æ–Ω–µ—Ç...">
                            <div class="search-icon">üîç</div>
                            <button class="search-clear" id="searchClear">√ó</button>
                        </div>
                    </div>

                    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ -->
                    <div class="lang-switcher">
                        <button class="lang-btn active" data-lang="ru">RU</button>
                        <button class="lang-btn" data-lang="en">EN</button>
                    </div>
                    
                    <div class="theme-control">
                        <span class="theme-label" id="themeText">–¢—ë–º–Ω–∞—è</span>
                        <label class="theme-switch">
                            <input type="checkbox" id="themeToggle" checked>
                            <span class="theme-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- –°–ï–ö–¶–ò–Ø –ú–û–ù–ï–¢ -->
    <section class="section coins-section" id="coinsSection">
        <div class="container">
            <h2 class="section-title" id="coinsTitle">–¢–æ–ø –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç</h2>

            <!-- Fear & Greed Index -->
            <div class="fear-greed-widget">
                <h3 class="fear-greed-title">–ò–Ω–¥–µ–∫—Å –°—Ç—Ä–∞—Ö–∞ –∏ –ñ–∞–¥–Ω–æ—Å—Ç–∏</h3>
                <div class="fear-greed-container">
                    <div class="fear-greed-scale">
                        <div class="scale-labels">
                            <span>0</span><span>25</span><span>50</span><span>75</span><span>100</span>
                        </div>
                        <div class="scale-bar">
                            <div class="scale-gradient">
                                <div class="scale-segment extreme-fear"></div>
                                <div class="scale-segment fear"></div>
                                <div class="scale-segment neutral"></div>
                                <div class="scale-segment greed"></div>
                                <div class="scale-segment extreme-greed"></div>
                            </div>
                            <div class="fear-greed-indicator" id="fearGreedIndicator">
                                <div class="indicator-arrow"></div>
                                <div class="indicator-line"></div>
                            </div>
                        </div>
                        <div class="scale-states">
                            <span class="state-label">–ö—Ä–∞–π–Ω–∏–π —Å—Ç—Ä–∞—Ö</span>
                            <span class="state-label">–°—Ç—Ä–∞—Ö</span>
                            <span class="state-label">–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ</span>
                            <span class="state-label">–ñ–∞–¥–Ω–æ—Å—Ç—å</span>
                            <span class="state-label">–ö—Ä–∞–π–Ω—è—è –∂–∞–¥–Ω–æ—Å—Ç—å</span>
                        </div>
                    </div>
                    <div class="fear-greed-info">
                        <div class="current-value">
                            <span class="value-number" id="fearGreedValue">75</span>
                            <span class="value-label">–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</span>
                        </div>
                        <div class="current-state">
                            <span class="state-text" id="fearGreedText">–ñ–∞–¥–Ω–æ—Å—Ç—å</span>
                            <span class="state-label">–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä—ã–Ω–∫–∞</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ –º–æ–Ω–µ—Ç -->
            <div class="coins-table-container">
                <table class="coins-table" id="coinsTable">
                    <thead>
                        <tr>
                            <th class="coin-rank" data-sort="market_cap_rank">#</th>
                            <th data-sort="name">–ú–æ–Ω–µ—Ç–∞</th>
                            <th data-sort="current_price">–¶–µ–Ω–∞</th>
                            <th data-sort="price_change_percentage_24h">24—á</th>
                            <th data-sort="market_cap">–ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è</th>
                            <th data-sort="total_volume">–û–±—ä–µ–º (24—á)</th>
                            <th>–ì—Ä–∞—Ñ–∏–∫ (7–¥)</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="coinsTableBody">
                        <!-- –ú–æ–Ω–µ—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </tbody>
                </table>
            </div>

            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            <div class="pagination">
                <button class="page-btn disabled" id="prevPage">‚Üê –ù–∞–∑–∞–¥</button>
                <span class="page-info" id="pageInfo">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1</span>
                <button class="page-btn" id="nextPage">–í–ø–µ—Ä—ë–¥ ‚Üí</button>
            </div>
        </div>
    </section>

    <script>
        // ===== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =====
        const CONFIG = {
            coinsPerPage: 100,
            currentPage: 1,
            currentLang: 'ru',
            currentTheme: 'dark',
            sortField: 'market_cap_rank',
            sortDirection: 'asc'
        };

        // ===== –î–ê–ù–ù–´–ï =====
        let allCoinsCache = [];
        let currentCoins = [];
        let charts = {};

        // ===== –ü–ï–†–ï–í–û–î–´ =====
        const TRANSLATIONS = {
            ru: {
                siteLogo: 'CryptoDrom',
                themeText: '–¢—ë–º–Ω–∞—è',
                coinsTitle: '–¢–æ–ø –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç',
                searchPlaceholder: '–ü–æ–∏—Å–∫ –º–æ–Ω–µ—Ç...',
                fearGreedTitle: '–ò–Ω–¥–µ–∫—Å –°—Ç—Ä–∞—Ö–∞ –∏ –ñ–∞–¥–Ω–æ—Å—Ç–∏',
                page: '–°—Ç—Ä–∞–Ω–∏—Ü–∞',
                tradingView: 'TradingView',
                details: '–î–µ—Ç–∞–ª–∏',
                noCoinsFound: '–ú–æ–Ω–µ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã',
                loading: '–ó–∞–≥—Ä—É–∑–∫–∞...'
            },
            en: {
                siteLogo: 'CryptoDrom',
                themeText: 'Dark',
                coinsTitle: 'Top Cryptocurrencies',
                searchPlaceholder: 'Search coins...',
                fearGreedTitle: 'Fear & Greed Index',
                page: 'Page',
                tradingView: 'TradingView',
                details: 'Details',
                noCoinsFound: 'No coins found',
                loading: 'Loading...'
            }
        };

        // ===== –ë–ê–ó–ê –î–ê–ù–ù–´–• –ò–ö–û–ù–û–ö –ú–û–ù–ï–¢ =====
        const COIN_IMAGES = {
            'bitcoin': 'https://assets.coingecko.com/coins/images/1/small/bitcoin.png',
            'ethereum': 'https://assets.coingecko.com/coins/images/279/small/ethereum.png',
            'tether': 'https://assets.coingecko.com/coins/images/325/small/Tether.png',
            'bnb': 'https://assets.coingecko.com/coins/images/825/small/bnb-icon2_2x.png',
            'solana': 'https://assets.coingecko.com/coins/images/4128/small/solana.png',
            'ripple': 'https://assets.coingecko.com/coins/images/44/small/xrp-symbol-white-128.png',
            'cardano': 'https://assets.coingecko.com/coins/images/975/small/cardano.png',
            'dogecoin': 'https://assets.coingecko.com/coins/images/5/small/dogecoin.png',
            // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞
        };

        // ===== –¢–ï–°–¢–û–í–´–ï –î–ê–ù–ù–´–ï (100+ –ú–û–ù–ï–¢) =====
        const TEST_COINS = [
            // –¢–æ–ø 20 –º–æ–Ω–µ—Ç
            createCoin(1, "Bitcoin", "BTC", 58728.42, 2.5, 1150000000000, 28500000000),
            createCoin(2, "Ethereum", "ETH", 2935.51, -1.2, 352000000000, 15200000000),
            createCoin(3, "Tether", "USDT", 1.00, 0.0, 95600000000, 45200000000),
            createCoin(4, "BNB", "BNB", 585.32, 1.8, 88000000000, 1850000000),
            createCoin(5, "Solana", "SOL", 146.28, 4.2, 65000000000, 2850000000),
            // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞
        ];

        function createCoin(rank, name, symbol, price, change24h, marketCap, volume) {
            const coinId = name.toLowerCase().replace(/\s+/g, '-');
            const imageUrl = COIN_IMAGES[coinId] || `https://via.placeholder.com/32/2962ff/ffffff?text=${symbol.substring(0, 3)}`;
            
            return {
                id: coinId,
                name: name,
                symbol: symbol,
                image: imageUrl,
                current_price: price,
                price_change_percentage_24h: change24h,
                market_cap: marketCap,
                total_volume: volume,
                market_cap_rank: rank,
                sparkline_in_7d: {
                    price: generateMockSparklineData(price, change24h, 25)
                }
            };
        }

        // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ì–†–ê–§–ò–ö–û–í =====
        function generateMockSparklineData(currentPrice, changePercent, points = 25) {
            const data = [];
            let lastPrice = currentPrice;
            const volatility = Math.abs(changePercent) / 100 * 3;
            const trend = changePercent >= 0 ? 1 : -1;
            
            let startingPrice = currentPrice * (1 - (trend * volatility * 0.5));
            
            for (let i = 0; i < points; i++) {
                const progress = i / (points - 1);
                const trendEffect = trend * volatility * currentPrice * progress;
                const randomEffect = (Math.random() - 0.5) * volatility * currentPrice * 0.3;
                
                lastPrice = startingPrice + trendEffect + randomEffect;
                lastPrice = Math.max(lastPrice, currentPrice * 0.1);
                data.push(lastPrice);
            }
            
            return data;
        }

        function createSparklineChart(canvasId, data, isPositive) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return null;
            
            const ctx = canvas.getContext('2d');
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫
            const existingChart = Chart.getChart(canvasId);
            if (existingChart) {
                existingChart.destroy();
            }

            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map((_, i) => ''),
                    datasets: [{
                        data: data,
                        borderColor: isPositive ? '#00c853' : '#ff1744',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    },
                    scales: {
                        x: {
                            display: false,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            display: false,
                            grid: {
                                display: false
                            }
                        }
                    },
                    elements: {
                        line: {
                            borderWidth: 2
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // ===== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
        function formatCurrency(amount) {
            if (amount >= 1000000000) {
                return '$' + (amount / 1000000000).toFixed(2) + 'B';
            } else if (amount >= 1000000) {
                return '$' + (amount / 1000000).toFixed(2) + 'M';
            } else if (amount >= 1000) {
                return '$' + (amount / 1000).toFixed(2) + 'K';
            }
            return '$' + amount.toFixed(2);
        }

        function formatPrice(price) {
            if (price >= 1000) {
                return '$' + price.toLocaleString('en-US', { maximumFractionDigits: 0 });
            } else if (price >= 1) {
                return '$' + price.toLocaleString('en-US', { maximumFractionDigits: 2 });
            } else if (price >= 0.01) {
                return '$' + price.toFixed(4);
            } else {
                return '$' + price.toFixed(8);
            }
        }

        function sortCoins(coins, field, direction) {
            return [...coins].sort((a, b) => {
                let aVal = a[field];
                let bVal = b[field];
                
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
        }

        function renderCoinsTable(coins) {
            const tbody = document.getElementById('coinsTableBody');
            if (!tbody) {
                console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç coinsTableBody');
                return;
            }

            if (!coins || coins.length === 0) {
                const t = TRANSLATIONS[CONFIG.currentLang];
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            ${t.noCoinsFound}
                        </td>
                    </tr>
                `;
                return;
            }

            console.log(`üìä –†–µ–Ω–¥–µ—Ä–∏–º ${coins.length} –º–æ–Ω–µ—Ç`);
            
            const t = TRANSLATIONS[CONFIG.currentLang];
            
            tbody.innerHTML = coins.map((coin, index) => {
                const change = coin.price_change_percentage_24h || 0;
                const changeClass = change >= 0 ? 'change-positive' : 'change-negative';
                const changeSymbol = change >= 0 ? '+' : '';
                const chartId = `chart-${coin.id}-${index}`;

                return `
                    <tr>
                        <td class="coin-rank">${coin.market_cap_rank}</td>
                        <td>
                            <div class="coin-info">
                                <img src="${coin.image}" alt="${coin.name}" class="coin-icon" onerror="this.src='https://via.placeholder.com/32/2962ff/ffffff?text=${coin.symbol.substring(0, 3)}'">
                                <div class="coin-name-symbol">
                                    <div class="coin-name">${coin.name}</div>
                                    <div class="coin-symbol">${coin.symbol.toUpperCase()}</div>
                                </div>
                            </div>
                        </td>
                        <td class="coin-price">${formatPrice(coin.current_price)}</td>
                        <td class="coin-change ${changeClass}">
                            ${changeSymbol}${change.toFixed(2)}%
                        </td>
                        <td class="coin-market-cap">${formatCurrency(coin.market_cap)}</td>
                        <td class="coin-volume">${formatCurrency(coin.total_volume)}</td>
                        <td>
                            <div class="coin-sparkline">
                                <canvas id="${chartId}"></canvas>
                            </div>
                        </td>
                        <td>
                            <div class="coin-actions">
                                <a href="https://www.tradingview.com/symbols/${coin.symbol.toUpperCase()}USD/" target="_blank" class="action-btn">${t.tradingView}</a>
                                <a href="https://www.coingecko.com/en/coins/${coin.id}" target="_blank" class="action-btn">${t.details}</a>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ç–∞–±–ª–∏—Ü—ã
            setTimeout(() => {
                coins.forEach((coin, index) => {
                    const change = coin.price_change_percentage_24h || 0;
                    const chartData = coin.sparkline_in_7d ? coin.sparkline_in_7d.price : [];
                    const chartId = `chart-${coin.id}-${index}`;
                    
                    if (chartData.length > 0) {
                        charts[chartId] = createSparklineChart(chartId, chartData, change >= 0);
                    }
                });
            }, 100);
        }

        function performSearch(query) {
            if (!allCoinsCache.length) {
                allCoinsCache = TEST_COINS;
            }
            
            if (!query) {
                currentCoins = sortCoins(allCoinsCache, CONFIG.sortField, CONFIG.sortDirection)
                    .slice(0, CONFIG.coinsPerPage);
            } else {
                const searchTerm = query.toLowerCase();
                currentCoins = allCoinsCache.filter(coin => 
                    coin.name.toLowerCase().includes(searchTerm) ||
                    coin.symbol.toLowerCase().includes(searchTerm)
                );
                currentCoins = sortCoins(currentCoins, CONFIG.sortField, CONFIG.sortDirection)
                    .slice(0, CONFIG.coinsPerPage);
            }
            
            renderCoinsTable(currentCoins);
        }

        function initSearch() {
            const searchInput = document.getElementById('mainSearch');
            const searchClear = document.getElementById('searchClear');
            
            if (!searchInput) return;
            
            let searchTimeout;
            searchInput.addEventListener('input', function(e) {
                if (searchClear) {
                    searchClear.style.display = this.value.length > 0 ? 'block' : 'none';
                }
                
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performSearch(this.value.trim());
                }, 300);
            });
            
            if (searchClear) {
                searchClear.addEventListener('click', function() {
                    searchInput.value = '';
                    searchInput.focus();
                    this.style.display = 'none';
                    performSearch('');
                });
            }
        }

        function initSorting() {
            const tableHeaders = document.querySelectorAll('.coins-table th[data-sort]');
            
            tableHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const field = this.getAttribute('data-sort');
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É —É –≤—Å–µ—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
                    tableHeaders.forEach(h => {
                        h.classList.remove('sort-asc', 'sort-desc');
                    });
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
                    if (CONFIG.sortField === field) {
                        CONFIG.sortDirection = CONFIG.sortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        CONFIG.sortField = field;
                        CONFIG.sortDirection = 'asc';
                    }
                    
                    this.classList.add(CONFIG.sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
                    
                    performSearch(document.getElementById('mainSearch').value);
                });
            });
        }

        function initThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const themeText = document.getElementById('themeText');
            
            if (!themeToggle) return;
            
            themeToggle.addEventListener('change', function() {
                const newTheme = this.checked ? 'dark' : 'light';
                document.body.setAttribute('data-theme', newTheme);
                CONFIG.currentTheme = newTheme;
                
                const t = TRANSLATIONS[CONFIG.currentLang];
                themeText.textContent = this.checked ? 
                    (CONFIG.currentLang === 'ru' ? '–¢—ë–º–Ω–∞—è' : 'Dark') : 
                    (CONFIG.currentLang === 'ru' ? '–°–≤–µ—Ç–ª–∞—è' : 'Light');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã
                setTimeout(() => {
                    Object.keys(charts).forEach(chartId => {
                        const chart = charts[chartId];
                        if (chart) {
                            chart.update();
                        }
                    });
                }, 100);
            });
        }

        function initLanguageToggle() {
            const langButtons = document.querySelectorAll('.lang-btn');
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                    langButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    CONFIG.currentLang = lang;
                    updateTranslations();
                });
            });
        }

        function updateTranslations() {
            const t = TRANSLATIONS[CONFIG.currentLang];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç—ã
            document.getElementById('siteLogo').textContent = t.siteLogo;
            document.getElementById('coinsTitle').textContent = t.coinsTitle;
            document.getElementById('mainSearch').placeholder = t.searchPlaceholder;
            document.querySelector('.fear-greed-title').textContent = t.fearGreedTitle;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–º—É
            const themeText = document.getElementById('themeText');
            if (themeText) {
                themeText.textContent = CONFIG.currentTheme === 'dark' ? 
                    (CONFIG.currentLang === 'ru' ? '–¢—ë–º–Ω–∞—è' : 'Dark') : 
                    (CONFIG.currentLang === 'ru' ? '–°–≤–µ—Ç–ª–∞—è' : 'Light');
            }
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –≤ –∫–Ω–æ–ø–∫–∞—Ö
            renderCoinsTable(currentCoins);
        }

        function initApp() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ
            if (!TEST_COINS || TEST_COINS.length === 0) {
                console.error('‚ùå –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö');
                return;
            }
            
            allCoinsCache = TEST_COINS;
            currentCoins = sortCoins(TEST_COINS, CONFIG.sortField, CONFIG.sortDirection)
                .slice(0, CONFIG.coinsPerPage);
            
            console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${TEST_COINS.length} –º–æ–Ω–µ—Ç`);
            
            renderCoinsTable(currentCoins);
            initSearch();
            initSorting();
            initThemeToggle();
            initLanguageToggle();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Fear & Greed
            const indicator = document.getElementById('fearGreedIndicator');
            if (indicator) indicator.style.left = '75%';
            
            console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–æ!');
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
