<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crypto Pulse — Реальные данные крипторынка</title>
  <meta name="description" content="Современная панель мониторинга криптовалют с данными CoinGecko и интерактивными графиками"/>
  <link rel="preconnect" href="https://api.coingecko.com"/>
  <link rel="preconnect" href="https://s3.tradingview.com"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --bg: #0a0e17;
      --card: #131827;
      --text: #e4e9f2;
      --muted: #8c9bb8;
      --accent: #6c63ff;
      --accent-gradient: linear-gradient(135deg, #6c63ff 0%, #3a7bd5 100%);
      --accent-2: #00d9ff;
      --red: #ff4757;
      --green: #2ed573;
      --border: #1e2538;
      --shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      --table-even: #111726;
      --link: #6c8bff;
      --glass: rgba(19, 24, 39, 0.85);
      --glass-border: rgba(255, 255, 255, 0.08);
    }
    
    [data-theme="light"] {
      --bg: #f8fafd;
      --card: #ffffff;
      --text: #1e293b;
      --muted: #64748b;
      --accent: #4f46e5;
      --accent-gradient: linear-gradient(135deg, #4f46e5 0%, #2563eb 100%);
      --accent-2: #06b6d4;
      --red: #ef4444;
      --green: #10b981;
      --border: #e2e8f0;
      --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      --table-even: #f8fafc;
      --link: #4f46e5;
      --glass: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(0, 0, 0, 0.08);
    }
    
    /* Smooth transitions */
    * {
      box-sizing: border-box;
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }
    
    /* Modern Header */
    .modern-header {
      position: sticky;
      top: 0;
      z-index: 1000;
      backdrop-filter: blur(20px) saturate(180%);
      background: var(--glass);
      border-bottom: 1px solid var(--glass-border);
    }
    
    .header-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 24px;
    }
    
    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 0;
    }
    
    .logo-brand {
      display: flex;
      align-items: center;
      gap: 14px;
      text-decoration: none;
    }
    
    .logo-icon {
      width: 44px;
      height: 44px;
      border-radius: 14px;
      background: var(--accent-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 22px;
      box-shadow: 0 8px 20px rgba(108, 99, 255, 0.3);
    }
    
    .brand-text {
      display: flex;
      flex-direction: column;
    }
    
    .brand-name {
      font-size: 22px;
      font-weight: 800;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }
    
    .brand-tagline {
      font-size: 12px;
      color: var(--muted);
      font-weight: 500;
      letter-spacing: 0.3px;
    }
    
    .header-controls {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .control-btn {
      background: var(--table-even);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .control-btn:hover {
      background: var(--card);
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }
    
    .search-wrapper {
      position: relative;
      width: 320px;
    }
    
    .search-input {
      width: 100%;
      background: var(--table-even);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 16px 12px 48px;
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
      outline: none;
    }
    
    .search-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
    }
    
    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      font-size: 16px;
    }
    
    .theme-toggle {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: var(--table-even);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text);
      cursor: pointer;
      font-size: 20px;
      transition: all 0.2s ease;
    }
    
    .theme-toggle:hover {
      background: var(--card);
      transform: rotate(15deg);
    }
    
    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      padding-bottom: 24px;
    }
    
    .stat-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 24px;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--accent-gradient);
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
    }
    
    .stat-label {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: 800;
      margin: 8px 0;
      line-height: 1.2;
    }
    
    .stat-change {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      font-weight: 600;
    }
    
    .stat-change.up {
      color: var(--green);
    }
    
    .stat-change.down {
      color: var(--red);
    }
    
    /* Main Container */
    .main-container {
      max-width: 1400px;
      margin: 32px auto;
      padding: 0 24px;
    }
    
    /* Filter Bar */
    .filter-bar {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
    }
    
    .filter-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .filter-group {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .filter-select {
      background: var(--table-even);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 16px;
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
      outline: none;
      cursor: pointer;
      min-width: 180px;
    }
    
    .filter-select:focus {
      border-color: var(--accent);
    }
    
    .toggle-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .toggle-label {
      font-size: 14px;
      color: var(--text);
      font-weight: 500;
    }
    
    /* Custom Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 26px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--border);
      transition: .4s;
      border-radius: 34px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
      background: var(--accent-gradient);
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(24px);
    }
    
    /* Table Container */
    .table-container {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    
    .table-header {
      display: grid;
      grid-template-columns: 60px 250px 120px 120px 150px 150px 180px 100px 80px;
      padding: 18px 24px;
      background: var(--table-even);
      border-bottom: 1px solid var(--border);
      font-size: 13px;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      align-items: center;
    }
    
    .table-row {
      display: grid;
      grid-template-columns: 60px 250px 120px 120px 150px 150px 180px 100px 80px;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      align-items: center;
      transition: all 0.2s ease;
    }
    
    .table-row:hover {
      background: rgba(108, 99, 255, 0.05);
    }
    
    .coin-cell {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .coin-icon {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      border: 2px solid var(--border);
      overflow: hidden;
    }
    
    .coin-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .coin-info {
      display: flex;
      flex-direction: column;
    }
    
    .coin-name {
      font-weight: 700;
      font-size: 15px;
      margin-bottom: 2px;
    }
    
    .coin-symbol {
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
    }
    
    .price-cell {
      font-weight: 700;
      font-size: 16px;
    }
    
    .change-cell {
      font-weight: 700;
      font-size: 15px;
    }
    
    .change-up {
      color: var(--green);
    }
    
    .change-down {
      color: var(--red);
    }
    
    /* Enhanced Sparklines */
    .sparkline-container {
      position: relative;
      height: 50px;
      width: 180px;
      cursor: pointer;
    }
    
    .sparkline-canvas {
      width: 100%;
      height: 100%;
    }
    
    .sparkline-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s ease;
      background: rgba(19, 24, 39, 0.8);
      border-radius: 8px;
    }
    
    .sparkline-container:hover .sparkline-overlay {
      opacity: 1;
    }
    
    .sparkline-stats {
      text-align: center;
      padding: 8px;
    }
    
    .sparkline-period {
      font-size: 10px;
      color: var(--muted);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .sparkline-change {
      font-size: 14px;
      font-weight: 700;
    }
    
    .market-cap-cell, .volume-cell {
      font-weight: 600;
      font-size: 14px;
    }
    
    .badge-cell {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    
    .badge {
      background: var(--table-even);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 4px 10px;
      font-size: 11px;
      font-weight: 600;
      color: var(--muted);
    }
    
    .favorite-cell {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .favorite-btn {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
    }
    
    .favorite-btn:hover {
      color: #ffcc00;
      background: rgba(255, 204, 0, 0.1);
    }
    
    .favorite-btn.active {
      color: #ffcc00;
    }
    
    /* Pagination */
    .pagination {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      background: var(--table-even);
      border-top: 1px solid var(--border);
    }
    
    .pagination-info {
      font-size: 14px;
      color: var(--muted);
      font-weight: 500;
    }
    
    .pagination-controls {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .pagination-btn {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 16px;
      color: var(--text);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
    }
    
    .pagination-btn:hover:not(:disabled) {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .page-size-select {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 12px;
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
    }
    
    /* Modal */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(10, 14, 23, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }
    
    .modal {
      width: min(1000px, 100%);
      max-height: 90vh;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 24px;
      overflow: hidden;
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
    }
    
    .modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--table-even);
    }
    
    .modal-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 22px;
      font-weight: 800;
      margin: 0;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 24px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      transition: all 0.2s ease;
    }
    
    .modal-close:hover {
      background: var(--border);
      color: var(--text);
    }
    
    .modal-content {
      padding: 24px;
      overflow-y: auto;
      max-height: calc(90vh - 80px);
    }
    
    .modal-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .modal-stat {
      background: var(--table-even);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
    }
    
    .modal-stat-label {
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }
    
    .modal-stat-value {
      font-size: 24px;
      font-weight: 800;
      margin: 8px 0;
    }
    
    .modal-chart {
      background: var(--table-even);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      height: 400px;
    }
    
    /* Footer */
    .footer {
      text-align: center;
      padding: 40px 24px;
      color: var(--muted);
      font-size: 14px;
      border-top: 1px solid var(--border);
      margin-top: 60px;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 16px;
    }
    
    .footer-link {
      color: var(--muted);
      text-decoration: none;
      transition: color 0.2s ease;
    }
    
    .footer-link:hover {
      color: var(--accent);
    }
    
    /* Search Results */
    .search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 0 0 16px 16px;
      max-height: 400px;
      overflow-y: auto;
      z-index: 100;
      display: none;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }
    
    .search-result {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    
    .search-result:hover {
      background: var(--table-even);
    }
    
    .search-result-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
    }
    
    /* Responsive */
    @media (max-width: 1200px) {
      .table-header, .table-row {
        grid-template-columns: 50px 200px 100px 100px 130px 130px 150px 90px 70px;
      }
    }
    
    @media (max-width: 992px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .header-top {
        flex-direction: column;
        gap: 20px;
      }
      
      .search-wrapper {
        width: 100%;
      }
      
      .table-container {
        overflow-x: auto;
      }
      
      .table-header, .table-row {
        min-width: 1200px;
      }
    }
    
    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .modal-stats {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .header-controls {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .filter-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      .filter-group {
        flex-wrap: wrap;
      }
    }
    
    @media (max-width: 576px) {
      .modal-stats {
        grid-template-columns: 1fr;
      }
      
      .pagination {
        flex-direction: column;
        gap: 16px;
      }
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-in {
      animation: fadeIn 0.5s ease forwards;
    }
    
    /* Loading */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Notification */
    .notification {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
    }
    
    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .notification-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 12px;
    }
    
    .notification-success .notification-icon {
      background: var(--green);
    }
    
    .notification-error .notification-icon {
      background: var(--red);
    }
    
    /* Performance Bars */
    .performance-bar {
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 8px;
      position: relative;
    }
    
    .performance-fill {
      height: 100%;
      background: var(--accent-gradient);
      border-radius: 2px;
      position: relative;
      overflow: hidden;
    }
    
    .performance-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255, 255, 255, 0.2) 50%, 
        transparent 100%);
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
  </style>
</head>
<body data-theme="dark">
<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div style="color: var(--muted); margin-top: 16px; font-weight: 500;">Загрузка данных крипторынка...</div>
</div>

<!-- Notification -->
<div class="notification" id="notification">
  <div class="notification-icon">✓</div>
  <div class="notification-message">Данные успешно загружены</div>
</div>

<!-- Modern Header -->
<header class="modern-header">
  <div class="header-container">
    <div class="header-top">
      <a href="#" class="logo-brand">
        <div class="logo-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="brand-text">
          <div class="brand-name">Crypto Pulse</div>
          <div class="brand-tagline">Реальные данные крипторынка</div>
        </div>
      </a>
      
      <div class="header-controls">
        <div class="search-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-input" id="searchInput" placeholder="Поиск по названию или тикеру...">
          <div class="search-results" id="searchResults"></div>
        </div>
        
        <button class="control-btn" id="refreshBtn">
          <i class="fas fa-sync-alt"></i>
          Обновить
        </button>
        
        <button class="theme-toggle" id="themeToggle">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>
    
    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">
          <i class="fas fa-globe"></i>
          Общая капитализация
        </div>
        <div class="stat-value" id="totalMarketCap">$2.41T</div>
        <div class="stat-change up">
          <i class="fas fa-arrow-up"></i>
          +2.4%
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-label">
          <i class="fas fa-chart-bar"></i>
          24ч Объём
        </div>
        <div class="stat-value" id="totalVolume">$84.2B</div>
        <div class="stat-change up">
          <i class="fas fa-arrow-up"></i>
          +5.1%
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-label">
          <i class="fab fa-bitcoin"></i>
          BTC Доминирование
        </div>
        <div class="stat-value" id="btcDominance">52.4%</div>
        <div class="stat-change down">
          <i class="fas fa-arrow-down"></i>
          -0.8%
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-label">
          <i class="fas fa-coins"></i>
          Активные монеты
        </div>
        <div class="stat-value" id="activeCoins">12,845</div>
        <div class="stat-change up">
          <i class="fas fa-arrow-up"></i>
          +24
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Main Container -->
<main class="main-container">
  <!-- Filter Bar -->
  <div class="filter-bar">
    <div class="filter-row">
      <div class="filter-group">
        <select class="filter-select" id="sortSelect">
          <option value="market_cap_desc">Рыночная капитализация ↓</option>
          <option value="market_cap_asc">Рыночная капитализация ↑</option>
          <option value="volume_desc">Объём 24ч ↓</option>
          <option value="volume_asc">Объём 24ч ↑</option>
          <option value="price_desc">Цена ↓</option>
          <option value="price_asc">Цена ↑</option>
          <option value="change_desc">Изменение 24ч ↓</option>
          <option value="change_asc">Изменение 24ч ↑</option>
        </select>
        
        <select class="filter-select" id="currencySelect">
          <option value="usd">USD ($)</option>
          <option value="eur">EUR (€)</option>
          <option value="gbp">GBP (£)</option>
        </select>
      </div>
      
      <div class="filter-group">
        <div class="toggle-group">
          <span class="toggle-label">Только избранное</span>
          <label class="toggle-switch">
            <input type="checkbox" id="favoritesOnly">
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div class="toggle-group">
          <span class="toggle-label">Скрыть стейблкоины</span>
          <label class="toggle-switch">
            <input type="checkbox" id="hideStablecoins">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Table Container -->
  <div class="table-container">
    <!-- Table Header -->
    <div class="table-header">
      <div>#</div>
      <div>Монета</div>
      <div>Цена</div>
      <div>24ч</div>
      <div>Капитализация</div>
      <div>Объём 24ч</div>
      <div>7 дней</div>
      <div>Теги</div>
      <div></div>
    </div>
    
    <!-- Table Body -->
    <div id="tableBody">
      <!-- Data will be loaded here -->
    </div>
    
    <!-- Pagination -->
    <div class="pagination">
      <div class="pagination-info" id="paginationInfo">
        Показано <span id="showingCount">0</span> из <span id="totalCount">0</span>
      </div>
      
      <div class="pagination-controls">
        <button class="pagination-btn" id="prevPageBtn" disabled>
          <i class="fas fa-chevron-left"></i>
          Назад
        </button>
        
        <select class="page-size-select" id="pageSizeSelect">
          <option value="25">25 на странице</option>
          <option value="50" selected>50 на странице</option>
          <option value="100">100 на странице</option>
        </select>
        
        <button class="pagination-btn" id="nextPageBtn">
          Вперед
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</main>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <div class="modal-header">
      <h2 class="modal-title">
        <img src="" alt="" id="modalCoinIcon" style="width: 32px; height: 32px; border-radius: 8px;">
        <span id="modalCoinName">Bitcoin</span>
        <span id="modalCoinSymbol" style="color: var(--muted); font-size: 18px;">(BTC)</span>
      </h2>
      <button class="modal-close" id="modalCloseBtn">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-content">
      <div class="modal-stats">
        <div class="modal-stat">
          <div class="modal-stat-label">Текущая цена</div>
          <div class="modal-stat-value" id="modalCurrentPrice">$68,421.50</div>
          <div class="performance-bar">
            <div class="performance-fill" style="width: 85%;"></div>
          </div>
        </div>
        
        <div class="modal-stat">
          <div class="modal-stat-label">Изменение за 24ч</div>
          <div class="modal-stat-value change-up" id="modal24hChange">+3.2%</div>
          <div class="performance-bar">
            <div class="performance-fill" style="width: 65%;"></div>
          </div>
        </div>
        
        <div class="modal-stat">
          <div class="modal-stat-label">Рыночная капитализация</div>
          <div class="modal-stat-value" id="modalMarketCap">$1.34T</div>
          <div class="performance-bar">
            <div class="performance-fill" style="width: 92%;"></div>
          </div>
        </div>
        
        <div class="modal-stat">
          <div class="modal-stat-label">Объём 24ч</div>
          <div class="modal-stat-value" id="modalVolume">$32.8B</div>
          <div class="performance-bar">
            <div class="performance-fill" style="width: 78%;"></div>
          </div>
        </div>
        
        <div class="modal-stat">
          <div class="modal-stat-label">Циркулирующее предложение</div>
          <div class="modal-stat-value" id="modalSupply">19.6M BTC</div>
          <div class="performance-bar">
            <div class="performance-fill" style="width: 93%;"></div>
          </div>
        </div>
        
        <div class="modal-stat">
          <div class="modal-stat-label">Рейтинг</div>
          <div class="modal-stat-value" id="modalRank">#1</div>
          <div class="performance-bar">
            <div class="performance-fill" style="width: 100%;"></div>
          </div>
        </div>
      </div>
      
      <div class="modal-chart" id="modalChartContainer">
        <!-- TradingView chart will be loaded here -->
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="footer">
  <div>© 2024 Crypto Pulse. Данные предоставлены CoinGecko API.</div>
  <div class="footer-links">
    <a href="https://www.coingecko.com" target="_blank" class="footer-link">CoinGecko</a>
    <a href="https://www.tradingview.com" target="_blank" class="footer-link">TradingView</a>
    <a href="#" class="footer-link" id="aboutBtn">О проекте</a>
  </div>
</footer>

<!-- TradingView Widget Script -->
<script src="https://s3.tradingview.com/tv.js"></script>

<script>
(async function() {
  // App state
  const state = {
    coins: [],
    filteredCoins: [],
    favorites: new Set(JSON.parse(localStorage.getItem('cryptoFavorites') || '[]')),
    currentPage: 1,
    pageSize: 50,
    sortBy: 'market_cap_desc',
    currency: 'usd',
    favoritesOnly: false,
    hideStablecoins: false,
    searchQuery: '',
    theme: localStorage.getItem('theme') || 'dark',
    globalStats: null,
    tvWidgets: {}
  };

  // DOM elements
  const dom = {
    loadingOverlay: document.getElementById('loadingOverlay'),
    notification: document.getElementById('notification'),
    searchInput: document.getElementById('searchInput'),
    searchResults: document.getElementById('searchResults'),
    refreshBtn: document.getElementById('refreshBtn'),
    themeToggle: document.getElementById('themeToggle'),
    totalMarketCap: document.getElementById('totalMarketCap'),
    totalVolume: document.getElementById('totalVolume'),
    btcDominance: document.getElementById('btcDominance'),
    activeCoins: document.getElementById('activeCoins'),
    sortSelect: document.getElementById('sortSelect'),
    currencySelect: document.getElementById('currencySelect'),
    favoritesOnly: document.getElementById('favoritesOnly'),
    hideStablecoins: document.getElementById('hideStablecoins'),
    tableBody: document.getElementById('tableBody'),
    paginationInfo: document.getElementById('paginationInfo'),
    showingCount: document.getElementById('showingCount'),
    totalCount: document.getElementById('totalCount'),
    prevPageBtn: document.getElementById('prevPageBtn'),
    nextPageBtn: document.getElementById('nextPageBtn'),
    pageSizeSelect: document.getElementById('pageSizeSelect'),
    modalBackdrop: document.getElementById('modalBackdrop'),
    modalCloseBtn: document.getElementById('modalCloseBtn'),
    modalCoinIcon: document.getElementById('modalCoinIcon'),
    modalCoinName: document.getElementById('modalCoinName'),
    modalCoinSymbol: document.getElementById('modalCoinSymbol'),
    modalCurrentPrice: document.getElementById('modalCurrentPrice'),
    modal24hChange: document.getElementById('modal24hChange'),
    modalMarketCap: document.getElementById('modalMarketCap'),
    modalVolume: document.getElementById('modalVolume'),
    modalSupply: document.getElementById('modalSupply'),
    modalRank: document.getElementById('modalRank'),
    modalChartContainer: document.getElementById('modalChartContainer'),
    aboutBtn: document.getElementById('aboutBtn')
  };

  // Initialize
  init();
  
  async function init() {
    // Set theme
    document.body.setAttribute('data-theme', state.theme);
    dom.themeToggle.innerHTML = state.theme === 'dark' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
    
    // Load data
    await loadGlobalStats();
    await loadCoinData();
    renderTable();
    
    // Hide loading
    setTimeout(() => {
      dom.loadingOverlay.style.display = 'none';
      showNotification('Данные успешно загружены', 'success');
    }, 1000);
    
    // Setup event listeners
    setupEventListeners();
    
    // Auto refresh every 2 minutes
    setInterval(async () => {
      await loadCoinData();
      renderTable();
      showNotification('Данные обновлены', 'success');
    }, 120000);
  }
  
  function setupEventListeners() {
    // Search
    dom.searchInput.addEventListener('input', debounce(handleSearch, 300));
    
    // Refresh
    dom.refreshBtn.addEventListener('click', async () => {
      dom.refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Обновление';
      await loadCoinData();
      await loadGlobalStats();
      renderTable();
      dom.refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Обновить';
      showNotification('Данные обновлены', 'success');
    });
    
    // Theme toggle
    dom.themeToggle.addEventListener('click', toggleTheme);
    
    // Filters
    dom.sortSelect.addEventListener('change', (e) => {
      state.sortBy = e.target.value;
      sortCoins();
      renderTable();
    });
    
    dom.currencySelect.addEventListener('change', (e) => {
      state.currency = e.target.value;
      // In a real app, you would reload data with new currency
      renderTable();
    });
    
    dom.favoritesOnly.addEventListener('change', (e) => {
      state.favoritesOnly = e.target.checked;
      filterCoins();
      renderTable();
    });
    
    dom.hideStablecoins.addEventListener('change', (e) => {
      state.hideStablecoins = e.target.checked;
      filterCoins();
      renderTable();
    });
    
    // Pagination
    dom.prevPageBtn.addEventListener('click', () => {
      if (state.currentPage > 1) {
        state.currentPage--;
        renderTable();
      }
    });
    
    dom.nextPageBtn.addEventListener('click', () => {
      const totalPages = Math.ceil(state.filteredCoins.length / state.pageSize);
      if (state.currentPage < totalPages) {
        state.currentPage++;
        renderTable();
      }
    });
    
    dom.pageSizeSelect.addEventListener('change', (e) => {
      state.pageSize = parseInt(e.target.value);
      state.currentPage = 1;
      renderTable();
    });
    
    // Modal
    dom.modalCloseBtn.addEventListener('click', () => {
      dom.modalBackdrop.style.display = 'none';
      // Remove TV widget
      if (state.tvWidget) {
        state.tvWidget.remove();
        state.tvWidget = null;
      }
    });
    
    dom.modalBackdrop.addEventListener('click', (e) => {
      if (e.target === dom.modalBackdrop) {
        dom.modalBackdrop.style.display = 'none';
        if (state.tvWidget) {
          state.tvWidget.remove();
          state.tvWidget = null;
        }
      }
    });
    
    // About
    dom.aboutBtn.addEventListener('click', (e) => {
      e.preventDefault();
      showNotification('Crypto Pulse — панель мониторинга крипторынка в реальном времени', 'info');
    });
  }
  
  async function loadGlobalStats() {
    try {
      const response = await fetch('https://api.coingecko.com/api/v3/global');
      const data = await response.json();
      state.globalStats = data.data;
      
      // Update UI
      dom.totalMarketCap.textContent = formatCurrency(state.globalStats.total_market_cap.usd);
      dom.totalVolume.textContent = formatCurrency(state.globalStats.total_volume.usd);
      dom.btcDominance.textContent = state.globalStats.market_cap_percentage.btc.toFixed(1) + '%';
      dom.activeCoins.textContent = state.globalStats.active_cryptocurrencies.toLocaleString();
    } catch (error) {
      console.error('Error loading global stats:', error);
    }
  }
  
  async function loadCoinData() {
    try {
      const response = await fetch(
        `https://api.coingecko.com/api/v3/coins/markets?vs_currency=${state.currency}&order=market_cap_desc&per_page=250&page=1&sparkline=true&price_change_percentage=1h,24h,7d`
      );
      state.coins = await response.json();
      filterCoins();
      sortCoins();
    } catch (error) {
      console.error('Error loading coin data:', error);
      showNotification('Ошибка загрузки данных', 'error');
    }
  }
  
  function filterCoins() {
    state.filteredCoins = state.coins.filter(coin => {
      // Search filter
      if (state.searchQuery) {
        const query = state.searchQuery.toLowerCase();
        if (!coin.name.toLowerCase().includes(query) && !coin.symbol.toLowerCase().includes(query)) {
          return false;
        }
      }
      
      // Favorites filter
      if (state.favoritesOnly && !state.favorites.has(coin.id)) {
        return false;
      }
      
      // Stablecoins filter
      if (state.hideStablecoins && coin.symbol.toLowerCase().includes('usd')) {
        return false;
      }
      
      return true;
    });
  }
  
  function sortCoins() {
    const [field, direction] = state.sortBy.split('_');
    
    state.filteredCoins.sort((a, b) => {
      let valueA, valueB;
      
      switch(field) {
        case 'market':
          valueA = a.market_cap;
          valueB = b.market_cap;
          break;
        case 'volume':
          valueA = a.total_volume;
          valueB = b.total_volume;
          break;
        case 'price':
          valueA = a.current_price;
          valueB = b.current_price;
          break;
        case 'change':
          valueA = a.price_change_percentage_24h || 0;
          valueB = b.price_change_percentage_24h || 0;
          break;
        default:
          valueA = a.market_cap;
          valueB = b.market_cap;
      }
      
      if (direction === 'desc') {
        return valueB - valueA;
      } else {
        return valueA - valueB;
      }
    });
  }
  
  function renderTable() {
    const startIndex = (state.currentPage - 1) * state.pageSize;
    const endIndex = startIndex + state.pageSize;
    const coinsToShow = state.filteredCoins.slice(startIndex, endIndex);
    
    // Update pagination info
    dom.showingCount.textContent = `${startIndex + 1}-${Math.min(endIndex, state.filteredCoins.length)}`;
    dom.totalCount.textContent = state.filteredCoins.length;
    
    // Update pagination buttons
    dom.prevPageBtn.disabled = state.currentPage === 1;
    dom.nextPageBtn.disabled = endIndex >= state.filteredCoins.length;
    
    // Render coins
    dom.tableBody.innerHTML = coinsToShow.map((coin, index) => {
      const rank = startIndex + index + 1;
      const isFavorite = state.favorites.has(coin.id);
      const changeClass = coin.price_change_percentage_24h >= 0 ? 'change-up' : 'change-down';
      const changeIcon = coin.price_change_percentage_24h >= 0 ? '▲' : '▼';
      
      // Prepare sparkline data
      const sparklineId = `sparkline-${coin.id}`;
      
      return `
        <div class="table-row animate-in" data-coin-id="${coin.id}">
          <div style="font-weight: 700; color: var(--muted);">${rank}</div>
          
          <div class="coin-cell">
            <div class="coin-icon">
              <img src="${coin.image}" alt="${coin.name}">
            </div>
            <div class="coin-info">
              <div class="coin-name">${coin.name}</div>
              <div class="coin-symbol">${coin.symbol.toUpperCase()}</div>
            </div>
          </div>
          
          <div class="price-cell">${formatCurrency(coin.current_price)}</div>
          
          <div class="change-cell ${changeClass}">
            ${changeIcon} ${Math.abs(coin.price_change_percentage_24h || 0).toFixed(2)}%
          </div>
          
          <div class="market-cap-cell">${formatCurrency(coin.market_cap)}</div>
          
          <div class="volume-cell">${formatCurrency(coin.total_volume)}</div>
          
          <div class="sparkline-container" id="${sparklineId}">
            <canvas class="sparkline-canvas" width="180" height="50"></canvas>
            <div class="sparkline-overlay">
              <div class="sparkline-stats">
                <div class="sparkline-period">7 ДНЕЙ</div>
                <div class="sparkline-change ${coin.price_change_percentage_7d_in_currency >= 0 ? 'change-up' : 'change-down'}">
                  ${coin.price_change_percentage_7d_in_currency >= 0 ? '+' : ''}${coin.price_change_percentage_7d_in_currency?.toFixed(2) || '0.00'}%
                </div>
              </div>
            </div>
          </div>
          
          <div class="badge-cell">
            ${coin.symbol.toUpperCase().includes('USD') ? '<span class="badge">СТЕЙБЛ</span>' : ''}
            ${coin.market_cap_rank <= 10 ? '<span class="badge">ТОП-10</span>' : ''}
            ${coin.market_cap_rank <= 50 ? '<span class="badge">ТОП-50</span>' : ''}
          </div>
          
          <div class="favorite-cell">
            <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-coin-id="${coin.id}">
              <i class="fas fa-star"></i>
            </button>
          </div>
        </div>
      `;
    }).join('');
    
    // Add event listeners to new elements
    coinsToShow.forEach(coin => {
      // Sparkline click
      const sparklineContainer = document.getElementById(`sparkline-${coin.id}`);
      if (sparklineContainer) {
        sparklineContainer.addEventListener('click', () => openCoinModal(coin));
        
        // Draw sparkline
        setTimeout(() => drawSparkline(coin), 100);
      }
      
      // Row click
      const row = document.querySelector(`[data-coin-id="${coin.id}"]`);
      if (row) {
        row.addEventListener('click', (e) => {
          if (!e.target.closest('.favorite-btn') && !e.target.closest('.sparkline-container')) {
            openCoinModal(coin);
          }
        });
      }
      
      // Favorite button
      const favoriteBtn = document.querySelector(`[data-coin-id="${coin.id}"] .favorite-btn`);
      if (favoriteBtn) {
        favoriteBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          toggleFavorite(coin.id);
        });
      }
    });
  }
  
  function drawSparkline(coin) {
    const canvas = document.querySelector(`#sparkline-${coin.id} canvas`);
    if (!canvas || !coin.sparkline_in_7d?.price) return;
    
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    const data = coin.sparkline_in_7d.price;
    
    // Clear canvas
    ctx.clearRect(0, 0, width, height);
    
    // Calculate min and max
    const min = Math.min(...data);
    const max = Math.max(...data);
    const range = max - min;
    
    // Set line color
    const isPositive = data[data.length - 1] >= data[0];
    ctx.strokeStyle = isPositive ? getComputedStyle(document.body).getPropertyValue('--green') : 
                                   getComputedStyle(document.body).getPropertyValue('--red');
    ctx.lineWidth = 2;
    ctx.lineJoin = 'round';
    ctx.lineCap = 'round';
    
    // Draw line
    ctx.beginPath();
    data.forEach((value, index) => {
      const x = (index / (data.length - 1)) * width;
      const y = height - ((value - min) / range) * height * 0.8 - height * 0.1;
      
      if (index === 0) {
        ctx.moveTo(x, y);
      } else {
        ctx.lineTo(x, y);
      }
    });
    ctx.stroke();
    
    // Draw gradient fill
    const gradient = ctx.createLinearGradient(0, 0, 0, height);
    gradient.addColorStop(0, isPositive ? 
      'rgba(46, 213, 115, 0.2)' : 'rgba(255, 71, 87, 0.2)');
    gradient.addColorStop(1, 'transparent');
    
    ctx.fillStyle = gradient;
    ctx.lineTo(width, height);
    ctx.lineTo(0, height);
    ctx.closePath();
    ctx.fill();
  }
  
  function openCoinModal(coin) {
    // Update modal content
    dom.modalCoinIcon.src = coin.image;
    dom.modalCoinName.textContent = coin.name;
    dom.modalCoinSymbol.textContent = `(${coin.symbol.toUpperCase()})`;
    dom.modalCurrentPrice.textContent = formatCurrency(coin.current_price);
    dom.modal24hChange.textContent = `${coin.price_change_percentage_24h >= 0 ? '+' : ''}${coin.price_change_percentage_24h?.toFixed(2) || '0.00'}%`;
    dom.modal24hChange.className = `modal-stat-value ${coin.price_change_percentage_24h >= 0 ? 'change-up' : 'change-down'}`;
    dom.modalMarketCap.textContent = formatCurrency(coin.market_cap);
    dom.modalVolume.textContent = formatCurrency(coin.total_volume);
    dom.modalSupply.textContent = `${(coin.circulating_supply || 0).toLocaleString()} ${coin.symbol.toUpperCase()}`;
    dom.modalRank.textContent = `#${coin.market_cap_rank}`;
    
    // Show modal
    dom.modalBackdrop.style.display = 'flex';
    
    // Load TradingView chart
    setTimeout(() => loadTradingViewChart(coin.symbol), 100);
  }
  
  function loadTradingViewChart(symbol) {
    // Clear previous chart
    dom.modalChartContainer.innerHTML = '';
    
    // Create new chart
    if (typeof TradingView !== 'undefined') {
      state.tvWidget = new TradingView.widget({
        container_id: 'modalChartContainer',
        width: '100%',
        height: 400,
        symbol: getTradingViewSymbol(symbol),
        interval: 'D',
        timezone: 'Etc/UTC',
        theme: state.theme,
        style: '1',
        locale: 'ru',
        toolbar_bg: '#f1f3f6',
        enable_publishing: false,
        hide_side_toolbar: false,
        allow_symbol_change: true,
        details: true,
        studies: [
          'MACD@tv-basicstudies',
          'RSI@tv-basicstudies',
          'Volume@tv-basicstudies'
        ],
        show_popup_button: true,
        popup_width: '1000',
        popup_height: '650',
      });
    }
  }
  
  function getTradingViewSymbol(symbol) {
    const symbolMap = {
      'btc': 'BINANCE:BTCUSDT',
      'eth': 'BINANCE:ETHUSDT',
      'bnb': 'BINANCE:BNBUSDT',
      'sol': 'BINANCE:SOLUSDT',
      'xrp': 'BINANCE:XRPUSDT',
      'ada': 'BINANCE:ADAUSDT',
      'doge': 'BINANCE:DOGEUSDT',
      'dot': 'BINANCE:DOTUSDT',
      'matic': 'BINANCE:MATICUSDT',
      'shib': 'BINANCE:SHIBUSDT'
    };
    
    return symbolMap[symbol.toLowerCase()] || `BINANCE:${symbol.toUpperCase()}USDT`;
  }
  
  function toggleFavorite(coinId) {
    if (state.favorites.has(coinId)) {
      state.favorites.delete(coinId);
      showNotification('Удалено из избранного', 'info');
    } else {
      state.favorites.add(coinId);
      showNotification('Добавлено в избранное', 'success');
    }
    
    // Save to localStorage
    localStorage.setItem('cryptoFavorites', JSON.stringify([...state.favorites]));
    
    // Update UI
    renderTable();
  }
  
  function toggleTheme() {
    const newTheme = state.theme === 'dark' ? 'light' : 'dark';
    state.theme = newTheme;
    document.body.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    dom.themeToggle.innerHTML = newTheme === 'dark' ? 
      '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
    
    // Update TradingView chart if open
    if (dom.modalBackdrop.style.display === 'flex' && state.tvWidget) {
      setTimeout(() => {
        if (state.tvWidget) {
          state.tvWidget.remove();
          state.tvWidget = null;
          const currentCoin = document.querySelector('.table-row:hover')?.getAttribute('data-coin-id');
          if (currentCoin) {
            const coin = state.coins.find(c => c.id === currentCoin);
            if (coin) loadTradingViewChart(coin.symbol);
          }
        }
      }, 300);
    }
  }
  
  function handleSearch(e) {
    state.searchQuery = e.target.value;
    state.currentPage = 1;
    filterCoins();
    renderTable();
    
    // Show search results dropdown
    if (state.searchQuery.trim()) {
      showSearchResults();
    } else {
      dom.searchResults.style.display = 'none';
    }
  }
  
  function showSearchResults() {
    const results = state.coins
      .filter(coin => 
        coin.name.toLowerCase().includes(state.searchQuery.toLowerCase()) ||
        coin.symbol.toLowerCase().includes(state.searchQuery.toLowerCase())
      )
      .slice(0, 8);
    
    if (results.length > 0) {
      dom.searchResults.innerHTML = results.map(coin => `
        <div class="search-result" data-coin-id="${coin.id}">
          <img src="${coin.image}" alt="${coin.name}" class="search-result-icon">
          <div>
            <div style="font-weight: 600;">${coin.name}</div>
            <div style="font-size: 12px; color: var(--muted);">${coin.symbol.toUpperCase()}</div>
          </div>
          <div style="margin-left: auto; font-weight: 700;">${formatCurrency(coin.current_price)}</div>
        </div>
      `).join('');
      
      dom.searchResults.style.display = 'block';
      
      // Add click listeners
      dom.searchResults.querySelectorAll('.search-result').forEach(result => {
        result.addEventListener('click', () => {
          const coinId = result.getAttribute('data-coin-id');
          const coin = state.coins.find(c => c.id === coinId);
          if (coin) {
            openCoinModal(coin);
            dom.searchResults.style.display = 'none';
            dom.searchInput.value = '';
            state.searchQuery = '';
          }
        });
      });
    } else {
      dom.searchResults.innerHTML = `
        <div class="search-result">
          <div style="padding: 20px; text-align: center; color: var(--muted);">
            Ничего не найдено
          </div>
        </div>
      `;
      dom.searchResults.style.display = 'block';
    }
  }
  
  // Utility functions
  function formatCurrency(value) {
    if (value >= 1e12) {
      return '$' + (value / 1e12).toFixed(2) + 'T';
    } else if (value >= 1e9) {
      return '$' + (value / 1e9).toFixed(2) + 'B';
    } else if (value >= 1e6) {
      return '$' + (value / 1e6).toFixed(2) + 'M';
    } else if (value >= 1e3) {
      return '$' + (value / 1e3).toFixed(2) + 'K';
    } else if (value >= 1) {
      return '$' + value.toFixed(2);
    } else if (value >= 0.01) {
      return '$' + value.toFixed(4);
    } else {
      return '$' + value.toFixed(8);
    }
  }
  
  function showNotification(message, type = 'success') {
    const notification = dom.notification;
    notification.className = `notification notification-${type}`;
    notification.querySelector('.notification-icon').textContent = type === 'success' ? '✓' : '!';
    notification.querySelector('.notification-message').textContent = message;
    
    notification.classList.add('show');
    
    setTimeout(() => {
      notification.classList.remove('show');
    }, 3000);
  }
  
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }
})();
</script>
</body>
</html>
