<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crypto Pulse — Реальные данные крипторынка</title>
  <meta name="description" content="Современная панель мониторинга криптовалют с данными CoinGecko, интерактивными графиками и актуальными новостями"/>
  <link rel="preconnect" href="https://api.coingecko.com"/>
  <link rel="preconnect" href="https://s3.tradingview.com"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --bg: #0a0e17;
      --card: #131827;
      --text: #e4e9f2;
      --muted: #8c9bb8;
      --accent: #6c63ff;
      --accent-gradient: linear-gradient(135deg, #6c63ff 0%, #3a7bd5 100%);
      --accent-2: #00d9ff;
      --red: #ff4757;
      --green: #2ed573;
      --orange: #ffa502;
      --border: #1e2538;
      --shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      --table-even: #111726;
      --link: #6c8bff;
      --glass: rgba(19, 24, 39, 0.85);
      --glass-border: rgba(255, 255, 255, 0.08);
      --news-bg: rgba(30, 37, 56, 0.6);
    }
    
    [data-theme="light"] {
      --bg: #f8fafd;
      --card: #ffffff;
      --text: #1e293b;
      --muted: #64748b;
      --accent: #4f46e5;
      --accent-gradient: linear-gradient(135deg, #4f46e5 0%, #2563eb 100%);
      --accent-2: #06b6d4;
      --red: #ef4444;
      --green: #10b981;
      --orange: #f59e0b;
      --border: #e2e8f0;
      --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      --table-even: #f8fafc;
      --link: #4f46e5;
      --glass: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(0, 0, 0, 0.08);
      --news-bg: rgba(248, 250, 252, 0.8);
    }
    
    /* Smooth transitions */
    * {
      box-sizing: border-box;
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }
    
    /* Modern Header */
    .modern-header {
      position: sticky;
      top: 0;
      z-index: 1000;
      backdrop-filter: blur(20px) saturate(180%);
      background: var(--glass);
      border-bottom: 1px solid var(--glass-border);
    }
    
    .header-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 24px;
    }
    
    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 0;
    }
    
    .logo-brand {
      display: flex;
      align-items: center;
      gap: 14px;
      text-decoration: none;
    }
    
    .logo-icon {
      width: 44px;
      height: 44px;
      border-radius: 14px;
      background: var(--accent-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 22px;
      box-shadow: 0 8px 20px rgba(108, 99, 255, 0.3);
    }
    
    .brand-text {
      display: flex;
      flex-direction: column;
    }
    
    .brand-name {
      font-size: 22px;
      font-weight: 800;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }
    
    .brand-tagline {
      font-size: 12px;
      color: var(--muted);
      font-weight: 500;
      letter-spacing: 0.3px;
    }
    
    .header-controls {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .control-btn {
      background: var(--table-even);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .control-btn:hover {
      background: var(--card);
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }
    
    .search-wrapper {
      position: relative;
      width: 320px;
    }
    
    .search-input {
      width: 100%;
      background: var(--table-even);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 16px 12px 48px;
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
      outline: none;
    }
    
    .search-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
    }
    
    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      font-size: 16px;
    }
    
    .theme-toggle {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: var(--table-even);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text);
      cursor: pointer;
      font-size: 20px;
      transition: all 0.2s ease;
    }
    
    .theme-toggle:hover {
      background: var(--card);
      transform: rotate(15deg);
    }
    
    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      padding-bottom: 24px;
    }
    
    .stat-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 24px;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--accent-gradient);
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
    }
    
    .stat-label {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: 800;
      margin: 8px 0;
      line-height: 1.2;
    }
    
    .stat-change {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      font-weight: 600;
    }
    
    .stat-change.up {
      color: var(--green);
    }
    
    .stat-change.down {
      color: var(--red);
    }
    
    /* Main Container */
    .main-container {
      max-width: 1400px;
      margin: 32px auto;
      padding: 0 24px;
    }
    
    /* Filter Bar */
    .filter-bar {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
    }
    
    .filter-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .filter-group {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .filter-select {
      background: var(--table-even);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 16px;
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
      outline: none;
      cursor: pointer;
      min-width: 180px;
    }
    
    .filter-select:focus {
      border-color: var(--accent);
    }
    
    .toggle-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .toggle-label {
      font-size: 14px;
      color: var(--text);
      font-weight: 500;
    }
    
    /* Custom Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 26px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--border);
      transition: .4s;
      border-radius: 34px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
      background: var(--accent-gradient);
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(24px);
    }
    
    /* Table Container */
    .table-container {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: var(--shadow);
      margin-bottom: 32px;
    }
    
    .table-header {
      display: grid;
      grid-template-columns: 60px 250px 120px 120px 150px 150px 180px 100px 80px;
      padding: 18px 24px;
      background: var(--table-even);
      border-bottom: 1px solid var(--border);
      font-size: 13px;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      align-items: center;
    }
    
    .table-row {
      display: grid;
      grid-template-columns: 60px 250px 120px 120px 150px 150px 180px 100px 80px;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      align-items: center;
      transition: all 0.2s ease;
    }
    
    .table-row:hover {
      background: rgba(108, 99, 255, 0.05);
    }
    
    .coin-cell {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .coin-icon {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      border: 2px solid var(--border);
      overflow: hidden;
    }
    
    .coin-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .coin-info {
      display: flex;
      flex-direction: column;
    }
    
    .coin-name {
      font-weight: 700;
      font-size: 15px;
      margin-bottom: 2px;
    }
    
    .coin-symbol {
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
    }
    
    .price-cell {
      font-weight: 700;
      font-size: 16px;
    }
    
    .change-cell {
      font-weight: 700;
      font-size: 15px;
    }
    
    .change-up {
      color: var(--green);
    }
    
    .change-down {
      color: var(--red);
    }
    
    /* Enhanced Sparklines */
    .sparkline-container {
      position: relative;
      height: 50px;
      width: 180px;
      cursor: pointer;
    }
    
    .sparkline-canvas {
      width: 100%;
      height: 100%;
    }
    
    .sparkline-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s ease;
      background: rgba(19, 24, 39, 0.8);
      border-radius: 8px;
    }
    
    .sparkline-container:hover .sparkline-overlay {
      opacity: 1;
    }
    
    .sparkline-stats {
      text-align: center;
      padding: 8px;
    }
    
    .sparkline-period {
      font-size: 10px;
      color: var(--muted);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .sparkline-change {
      font-size: 14px;
      font-weight: 700;
    }
    
    .market-cap-cell, .volume-cell {
      font-weight: 600;
      font-size: 14px;
    }
    
    .badge-cell {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    
    .badge {
      background: var(--table-even);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 4px 10px;
      font-size: 11px;
      font-weight: 600;
      color: var(--muted);
    }
    
    .favorite-cell {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .favorite-btn {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
    }
    
    .favorite-btn:hover {
      color: #ffcc00;
      background: rgba(255, 204, 0, 0.1);
    }
    
    .favorite-btn.active {
      color: #ffcc00;
    }
    
    /* Pagination */
    .pagination {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      background: var(--table-even);
      border-top: 1px solid var(--border);
    }
    
    .pagination-info {
      font-size: 14px;
      color: var(--muted);
      font-weight: 500;
    }
    
    .pagination-controls {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .pagination-btn {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 16px;
      color: var(--text);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
    }
    
    .pagination-btn:hover:not(:disabled) {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .page-size-select {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 12px;
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
    }
    
    /* News Section */
    .news-section {
      margin: 32px auto;
      max-width: 1400px;
      padding: 0 24px;
    }
    
    .news-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }
    
    .news-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 800;
      margin: 0;
    }
    
    .news-title i {
      color: var(--accent);
      font-size: 28px;
    }
    
    .news-badge {
      background: var(--orange);
      color: white;
      font-size: 12px;
      font-weight: 700;
      padding: 4px 12px;
      border-radius: 20px;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    
    .news-refresh {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--accent-gradient);
      border: none;
      border-radius: 12px;
      padding: 10px 20px;
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .news-refresh:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(108, 99, 255, 0.3);
    }
    
    .news-refresh i {
      transition: transform 0.5s ease;
    }
    
    .news-refresh.refreshing i {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .news-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }
    
    .news-card {
      background: var(--news-bg);
      border: 1px solid var(--border);
      border-radius: 18px;
      overflow: hidden;
      transition: all 0.3s ease;
      cursor: pointer;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .news-card:hover {
      transform: translateY(-5px);
      border-color: var(--accent);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    }
    
    .news-card.new {
      position: relative;
    }
    
    .news-card.new::after {
      content: 'НОВОЕ';
      position: absolute;
      top: 12px;
      right: 12px;
      background: var(--orange);
      color: white;
      font-size: 10px;
      font-weight: 800;
      padding: 4px 10px;
      border-radius: 12px;
      z-index: 2;
    }
    
    .news-image {
      height: 200px;
      width: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }
    
    .news-card:hover .news-image {
      transform: scale(1.05);
    }
    
    .news-content {
      padding: 20px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .news-source {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .source-logo {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      object-fit: cover;
    }
    
    .source-name {
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
    }
    
    .news-time {
      margin-left: auto;
      font-size: 11px;
      color: var(--muted);
    }
    
    .news-title-text {
      font-size: 18px;
      font-weight: 700;
      line-height: 1.4;
      margin: 0 0 12px 0;
      flex: 1;
    }
    
    .news-description {
      font-size: 14px;
      color: var(--muted);
      line-height: 1.5;
      margin-bottom: 16px;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .news-tags {
      display: flex;
      gap: 8px;
      margin-top: auto;
    }
    
    .news-tag {
      background: rgba(108, 99, 255, 0.1);
      color: var(--accent);
      font-size: 11px;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 12px;
      border: 1px solid rgba(108, 99, 255, 0.2);
    }
    
    .news-tag.bitcoin {
      background: rgba(247, 147, 26, 0.1);
      color: #f7931a;
      border-color: rgba(247, 147, 26, 0.2);
    }
    
    .news-tag.ethereum {
      background: rgba(98, 126, 234, 0.1);
      color: #627eea;
      border-color: rgba(98, 126, 234, 0.2);
    }
    
    .news-tag.regulation {
      background: rgba(255, 71, 87, 0.1);
      color: var(--red);
      border-color: rgba(255, 71, 87, 0.2);
    }
    
    .news-tag.defi {
      background: rgba(46, 213, 115, 0.1);
      color: var(--green);
      border-color: rgba(46, 213, 115, 0.2);
    }
    
    .news-tag.nft {
      background: rgba(155, 81, 224, 0.1);
      color: #9b51e0;
      border-color: rgba(155, 81, 224, 0.2);
    }
    
    .news-loading {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
      gap: 24px;
    }
    
    .news-skeleton {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      overflow: hidden;
      height: 380px;
    }
    
    .skeleton-image {
      height: 200px;
      background: linear-gradient(90deg, var(--border) 25%, var(--table-even) 50%, var(--border) 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }
    
    .skeleton-content {
      padding: 20px;
    }
    
    .skeleton-line {
      height: 12px;
      background: linear-gradient(90deg, var(--border) 25%, var(--table-even) 50%, var(--border) 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    
    .skeleton-line.short {
      width: 60%;
    }
    
    .skeleton-line.medium {
      width: 80%;
    }
    
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    .news-empty {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }
    
    .news-empty i {
      font-size: 48px;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    
    /* Modal */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(10, 14, 23, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }
    
    .modal {
      width: min(1000px, 100%);
      max-height: 90vh;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 24px;
      overflow: hidden;
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
    }
    
    .modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--table-even);
    }
    
    .modal-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 22px;
      font-weight: 800;
      margin: 0;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 24px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      transition: all 0.2s ease;
    }
    
    .modal-close:hover {
      background: var(--border);
      color: var(--text);
    }
    
    .modal-content {
      padding: 24px;
      overflow-y: auto;
      max-height: calc(90vh - 80px);
    }
    
    .modal-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .modal-stat {
      background: var(--table-even);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
    }
    
    .modal-stat-label {
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }
    
    .modal-stat-value {
      font-size: 24px;
      font-weight: 800;
      margin: 8px 0;
    }
    
    .modal-chart {
      background: var(--table-even);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      height: 400px;
    }
    
    /* Footer */
    .footer {
      text-align: center;
      padding: 40px 24px;
      color: var(--muted);
      font-size: 14px;
      border-top: 1px solid var(--border);
      margin-top: 60px;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 16px;
    }
    
    .footer-link {
      color: var(--muted);
      text-decoration: none;
      transition: color 0.2s ease;
    }
    
    .footer-link:hover {
      color: var(--accent);
    }
    
    /* Search Results */
    .search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 0 0 16px 16px;
      max-height: 400px;
      overflow-y: auto;
      z-index: 100;
      display: none;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }
    
    .search-result {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    
    .search-result:hover {
      background: var(--table-even);
    }
    
    .search-result-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
    }
    
    /* Responsive */
    @media (max-width: 1200px) {
      .table-header, .table-row {
        grid-template-columns: 50px 200px 100px 100px 130px 130px 150px 90px 70px;
      }
    }
    
    @media (max-width: 992px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .header-top {
        flex-direction: column;
        gap: 20px;
      }
      
      .search-wrapper {
        width: 100%;
      }
      
      .table-container {
        overflow-x: auto;
      }
      
      .table-header, .table-row {
        min-width: 1200px;
      }
      
      .news-grid {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      }
    }
    
    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .modal-stats {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .header-controls {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .filter-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      .filter-group {
        flex-wrap: wrap;
      }
      
      .news-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
      
      .news-title {
        font-size: 20px;
      }
      
      .news-grid {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 576px) {
      .modal-stats {
        grid-template-columns: 1fr;
      }
      
      .pagination {
        flex-direction: column;
        gap: 16px;
      }
      
      .news-title {
        font-size: 18px;
      }
      
      .news-title i {
        font-size: 22px;
      }
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-in {
      animation: fadeIn 0.5s ease forwards;
    }
    
    /* Loading */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    /* Notification */
    .notification {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
    }
    
    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .notification-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 12px;
    }
    
    .notification-success .notification-icon {
      background: var(--green);
    }
    
    .notification-error .notification-icon {
      background: var(--red);
    }
    
    .notification-info .notification-icon {
      background: var(--accent);
    }
    
    /* Performance Bars */
    .performance-bar {
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 8px;
      position: relative;
    }
    
    .performance-fill {
      height: 100%;
      background: var(--accent-gradient);
      border-radius: 2px;
      position: relative;
      overflow: hidden;
    }
    
    .performance-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255, 255, 255, 0.2) 50%, 
        transparent 100%);
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    /* News Alert */
    .news-alert {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--accent-gradient);
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 15px 35px rgba(108, 99, 255, 0.3);
      z-index: 1001;
      opacity: 0;
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    .news-alert.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    
    .news-alert i {
      font-size: 20px;
    }
    
    .news-alert-content {
      flex: 1;
    }
    
    .news-alert-title {
      font-weight: 700;
      font-size: 14px;
      margin-bottom: 4px;
    }
    
    .news-alert-source {
      font-size: 12px;
      opacity: 0.9;
    }
    
    .news-alert-close {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
    }
  </style>
</head>
<body data-theme="dark">
<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div style="color: var(--muted); margin-top: 16px; font-weight: 500;">Загрузка данных крипторынка...</div>
</div>

<!-- Notification -->
<div class="notification" id="notification">
  <div class="notification-icon">✓</div>
  <div class="notification-message">Данные успешно загружены</div>
</div>

<!-- News Alert -->
<div class="news-alert" id="newsAlert">
  <i class="fas fa-bell"></i>
  <div class="news-alert-content">
    <div class="news-alert-title" id="newsAlertTitle">Новая важная новость!</div>
    <div class="news-alert-source" id="newsAlertSource"></div>
  </div>
  <button class="news-alert-close" id="newsAlertClose">
    <i class="fas fa-times"></i>
  </button>
</div>

<!-- Modern Header -->
<header class="modern-header">
  <div class="header-container">
    <div class="header-top">
      <a href="#" class="logo-brand">
        <div class="logo-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="brand-text">
          <div class="brand-name">Crypto Pulse</div>
          <div class="brand-tagline">Реальные данные крипторынка</div>
        </div>
      </a>
      
      <div class="header-controls">
        <div class="search-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-input" id="searchInput" placeholder="Поиск по названию или тикеру...">
          <div class="search-results" id="searchResults"></div>
        </div>
        
        <button class="control-btn" id="refreshBtn">
          <i class="fas fa-sync-alt"></i>
          Обновить
        </button>
        
        <button class="theme-toggle" id="themeToggle">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>
    
    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">
          <i class="fas fa-globe"></i>
          Общая капитализация
        </div>
        <div class="stat-value" id="totalMarketCap">$2.41T</div>
        <div class="stat-change up">
          <i class="fas fa-arrow-up"></i>
          +2.4%
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-label">
          <i class="fas fa-chart-bar"></i>
          24ч Объём
        </div>
        <div class="stat-value" id="totalVolume">$84.2B</div>
        <div class="stat-change up">
          <i class="fas fa-arrow-up"></i>
          +5.1%
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-label">
          <i class="fab fa-bitcoin"></i>
          BTC Доминирование
        </div>
        <div class="stat-value" id="btcDominance">52.4%</div>
        <div class="stat-change down">
          <i class="fas fa-arrow-down"></i>
          -0.8%
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-label">
          <i class="fas fa-newspaper"></i>
          Новостей за сутки
        </div>
        <div class="stat-value" id="newsCount">24</div>
        <div class="stat-change up">
          <i class="fas fa-arrow-up"></i>
          +3
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Main Container -->
<main class="main-container">
  <!-- Filter Bar -->
  <div class="filter-bar">
    <div class="filter-row">
      <div class="filter-group">
        <select class="filter-select" id="sortSelect">
          <option value="market_cap_desc">Рыночная капитализация ↓</option>
          <option value="market_cap_asc">Рыночная капитализация ↑</option>
          <option value="volume_desc">Объём 24ч ↓</option>
          <option value="volume_asc">Объём 24ч ↑</option>
          <option value="price_desc">Цена ↓</option>
          <option value="price_asc">Цена ↑</option>
          <option value="change_desc">Изменение 24ч ↓</option>
          <option value="change_asc">Изменение 24ч ↑</option>
        </select>
        
        <select class="filter-select" id="currencySelect">
          <option value="usd">USD ($)</option>
          <option value="eur">EUR (€)</option>
          <option value="gbp">GBP (£)</option>
        </select>
      </div>
      
      <div class="filter-group">
        <div class="toggle-group">
          <span class="toggle-label">Только избранное</span>
          <label class="toggle-switch">
            <input type="checkbox" id="favoritesOnly">
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div class="toggle-group">
          <span class="toggle-label">Скрыть стейблкоины</span>
          <label class="toggle-switch">
            <input type="checkbox" id="hideStablecoins">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Table Container -->
  <div class="table-container">
    <!-- Table Header -->
    <div class="table-header">
      <div>#</div>
      <div>Монета</div>
      <div>Цена</div>
      <div>24ч</div>
      <div>Капитализация</div>
      <div>Объём 24ч</div>
      <div>7 дней</div>
      <div>Теги</div>
      <div></div>
    </div>
    
    <!-- Table Body -->
    <div id="tableBody">
      <!-- Data will be loaded here -->
    </div>
    
    <!-- Pagination -->
    <div class="pagination">
      <div class="pagination-info" id="paginationInfo">
        Показано <span id="showingCount">0</span> из <span id="totalCount">0</span>
      </div>
      
      <div class="pagination-controls">
        <button class="pagination-btn" id="prevPageBtn" disabled>
          <i class="fas fa-chevron-left"></i>
          Назад
        </button>
        
        <select class="page-size-select" id="pageSizeSelect">
          <option value="25">25 на странице</option>
          <option value="50" selected>50 на странице</option>
          <option value="100">100 на странице</option>
        </select>
        
        <button class="pagination-btn" id="nextPageBtn">
          Вперед
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</main>

<!-- News Section -->
<section class="news-section">
  <div class="news-header">
    <div>
      <h2 class="news-title">
        <i class="fas fa-newspaper"></i>
        Актуальные криптоновости
        <span class="news-badge" id="liveNewsBadge">LIVE</span>
      </h2>
    </div>
    <button class="news-refresh" id="refreshNewsBtn">
      <i class="fas fa-sync-alt"></i>
      Обновить новости
    </button>
  </div>
  
  <div class="news-grid" id="newsGrid">
    <!-- News will be loaded here -->
  </div>
  
  <!-- Loading skeleton -->
  <div class="news-loading" id="newsLoading">
    <div class="news-skeleton">
      <div class="skeleton-image"></div>
      <div class="skeleton-content">
        <div class="skeleton-line short"></div>
        <div class="skeleton-line medium"></div>
        <div class="skeleton-line"></div>
        <div class="skeleton-line"></div>
      </div>
    </div>
    <div class="news-skeleton">
      <div class="skeleton-image"></div>
      <div class="skeleton-content">
        <div class="skeleton-line short"></div>
        <div class="skeleton-line medium"></div>
        <div class="skeleton-line"></div>
        <div class="skeleton-line"></div>
      </div>
    </div>
    <div class="news-skeleton">
      <div class="skeleton-image"></div>
      <div class="skeleton-content">
        <div class="skeleton-line short"></div>
        <div class="skeleton-line medium"></div>
        <div class="skeleton-line"></div>
        <div class="skeleton-line"></div>
      </div>
    </div>
  </div>
</section>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <div class="modal-header">
      <h2 class="modal-title">
        <img src="" alt="" id="modalCoinIcon" style="width: 32px; height: 32px; border-radius: 8px;">
        <span id="modalCoinName">Bitcoin</span>
        <span id="modalCoinSymbol" style="color: var(--muted); font-size: 18px;">(BTC)</span>
      </h2>
      <button class="modal-close" id="modalCloseBtn">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-content">
      <div class="modal-stats">
        <div class="modal-stat">
          <div class="modal-stat-label">Текущая цена</div>
          <div class="modal-stat-value" id="modalCurrentPrice">$68,421.50</div>
          <div class="performance-bar">
            <div class="performance-fill" style="width: 85%;"></div>
          </div>
        </div>
        
        <div class="modal-stat">
          <div class="modal-stat-label">Изменение за 24ч</div>
          <div class="modal-stat-value change-up" id="modal24hChange">+3.2%</div>
          <div class="performance-bar">
            <div class="performance-fill" style="width: 65%;"></div>
          </div>
        </div>
        
        <div class="modal-stat">
          <div class="modal-stat-label">Рыночная капитализация</div>
          <div class="modal-stat-value" id="modalMarketCap">$1.34T</div>
          <div class="performance-bar">
            <div class="performance-fill" style="width: 92%;"></div>
          </div>
        </div>
        
        <div class="modal-stat">
          <div class="modal-stat-label">Объём 24ч</div>
          <div class="modal-stat-value" id="modalVolume">$32.8B</div>
          <div class="performance-bar">
            <div class="performance-fill" style="width: 78%;"></div>
          </div>
        </div>
        
        <div class="modal-stat">
          <div class="modal-stat-label">Циркулирующее предложение</div>
          <div class="modal-stat-value" id="modalSupply">19.6M BTC</div>
          <div class="performance-bar">
            <div class="performance-fill" style="width: 93%;"></div>
          </div>
        </div>
        
        <div class="modal-stat">
          <div class="modal-stat-label">Рейтинг</div>
          <div class="modal-stat-value" id="modalRank">#1</div>
          <div class="performance-bar">
            <div class="performance-fill" style="width: 100%;"></div>
          </div>
        </div>
      </div>
      
      <div class="modal-chart" id="modalChartContainer">
        <!-- TradingView chart will be loaded here -->
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="footer">
  <div>© 2024 Crypto Pulse. Данные предоставлены CoinGecko API. Новости из открытых источников.</div>
  <div class="footer-links">
    <a href="https://www.coingecko.com" target="_blank" class="footer-link">CoinGecko</a>
    <a href="https://www.tradingview.com" target="_blank" class="footer-link">TradingView</a>
    <a href="#" class="footer-link" id="aboutBtn">О проекте</a>
  </div>
</footer>

<!-- TradingView Widget Script -->
<script src="https://s3.tradingview.com/tv.js"></script>

<script>
(async function() {
  // App state
  const state = {
    coins: [],
    filteredCoins: [],
    favorites: new Set(JSON.parse(localStorage.getItem('cryptoFavorites') || '[]')),
    currentPage: 1,
    pageSize: 50,
    sortBy: 'market_cap_desc',
    currency: 'usd',
    favoritesOnly: false,
    hideStablecoins: false,
    searchQuery: '',
    theme: localStorage.getItem('theme') || 'dark',
    globalStats: null,
    tvWidgets: {},
    news: [],
    lastNewsCheck: 0,
    newsCheckInterval: 300000, // 5 минут
    unseenNews: new Set()
  };

  // DOM elements
  const dom = {
    loadingOverlay: document.getElementById('loadingOverlay'),
    notification: document.getElementById('notification'),
    newsAlert: document.getElementById('newsAlert'),
    newsAlertTitle: document.getElementById('newsAlertTitle'),
    newsAlertSource: document.getElementById('newsAlertSource'),
    newsAlertClose: document.getElementById('newsAlertClose'),
    searchInput: document.getElementById('searchInput'),
    searchResults: document.getElementById('searchResults'),
    refreshBtn: document.getElementById('refreshBtn'),
    themeToggle: document.getElementById('themeToggle'),
    totalMarketCap: document.getElementById('totalMarketCap'),
    totalVolume: document.getElementById('totalVolume'),
    btcDominance: document.getElementById('btcDominance'),
    newsCount: document.getElementById('newsCount'),
    sortSelect: document.getElementById('sortSelect'),
    currencySelect: document.getElementById('currencySelect'),
    favoritesOnly: document.getElementById('favoritesOnly'),
    hideStablecoins: document.getElementById('hideStablecoins'),
    tableBody: document.getElementById('tableBody'),
    paginationInfo: document.getElementById('paginationInfo'),
    showingCount: document.getElementById('showingCount'),
    totalCount: document.getElementById('totalCount'),
    prevPageBtn: document.getElementById('prevPageBtn'),
    nextPageBtn: document.getElementById('nextPageBtn'),
    pageSizeSelect: document.getElementById('pageSizeSelect'),
    modalBackdrop: document.getElementById('modalBackdrop'),
    modalCloseBtn: document.getElementById('modalCloseBtn'),
    modalCoinIcon: document.getElementById('modalCoinIcon'),
    modalCoinName: document.getElementById('modalCoinName'),
    modalCoinSymbol: document.getElementById('modalCoinSymbol'),
    modalCurrentPrice: document.getElementById('modalCurrentPrice'),
    modal24hChange: document.getElementById('modal24hChange'),
    modalMarketCap: document.getElementById('modalMarketCap'),
    modalVolume: document.getElementById('modalVolume'),
    modalSupply: document.getElementById('modalSupply'),
    modalRank: document.getElementById('modalRank'),
    modalChartContainer: document.getElementById('modalChartContainer'),
    aboutBtn: document.getElementById('aboutBtn'),
    liveNewsBadge: document.getElementById('liveNewsBadge'),
    refreshNewsBtn: document.getElementById('refreshNewsBtn'),
    newsGrid: document.getElementById('newsGrid'),
    newsLoading: document.getElementById('newsLoading')
  };

  // News sources
  const newsSources = [
    { name: 'CoinDesk', logo: 'https://cryptoslate.com/wp-content/uploads/2021/12/coindesk.jpg', color: '#3b7cff' },
    { name: 'Cointelegraph', logo: 'https://cryptoslate.com/wp-content/uploads/2021/12/cointelegraph.jpg', color: '#20c997' },
    { name: 'CryptoSlate', logo: 'https://cryptoslate.com/wp-content/themes/cryptoslate-2020/imgs/logos/cryptoslate-logo.png', color: '#6c63ff' },
    { name: 'Bitcoin.com', logo: 'https://cryptoslate.com/wp-content/uploads/2021/12/bitcoin-com.jpg', color: '#f7931a' },
    { name: 'Decrypt', logo: 'https://cryptoslate.com/wp-content/uploads/2021/12/decrypt.jpg', color: '#8b5cf6' },
    { name: 'The Block', logo: 'https://cryptoslate.com/wp-content/uploads/2021/12/the-block.jpg', color: '#3b82f6' }
  ];

  // Crypto news topics
  const newsTopics = [
    { name: 'Bitcoin', tag: 'bitcoin', keywords: ['bitcoin', 'btc', 'сатоши'] },
    { name: 'Ethereum', tag: 'ethereum', keywords: ['ethereum', 'eth', 'виталик'] },
    { name: 'DeFi', tag: 'defi', keywords: ['defi', 'decentralized finance', 'децентрализованные финансы'] },
    { name: 'NFT', tag: 'nft', keywords: ['nft', 'non-fungible', 'токен'] },
    { name: 'Regulation', tag: 'regulation', keywords: ['regulation', 'regulatory', 'regulation', 'закон', 'правительство'] },
    { name: 'Exchange', tag: 'exchange', keywords: ['exchange', 'binance', 'coinbase', 'бирж'] },
    { name: 'Mining', tag: 'mining', keywords: ['mining', 'майнинг', 'майнер'] },
    { name: 'Wallet', tag: 'wallet', keywords: ['wallet', 'кошелек', 'метамаск'] }
  ];

  // Initialize
  init();
  
  async function init() {
    // Set theme
    document.body.setAttribute('data-theme', state.theme);
    dom.themeToggle.innerHTML = state.theme === 'dark' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
    
    // Load data
    await loadGlobalStats();
    await loadCoinData();
    await loadNews();
    renderTable();
    renderNews();
    
    // Hide loading
    setTimeout(() => {
      dom.loadingOverlay.style.display = 'none';
      showNotification('Данные успешно загружены', 'success');
    }, 1000);
    
    // Setup event listeners
    setupEventListeners();
    
    // Auto refresh every 2 minutes
    setInterval(async () => {
      await loadCoinData();
      await loadGlobalStats();
      renderTable();
      showNotification('Данные обновлены', 'success');
    }, 120000);
    
    // Auto check for new news every 5 minutes
    setInterval(async () => {
      const newNews = await checkForNewNews();
      if (newNews.length > 0) {
        showNewsAlert(newNews[0]);
      }
    }, state.newsCheckInterval);
  }
  
  function setupEventListeners() {
    // Search
    dom.searchInput.addEventListener('input', debounce(handleSearch, 300));
    
    // Refresh
    dom.refreshBtn.addEventListener('click', async () => {
      dom.refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Обновление';
      await loadCoinData();
      await loadGlobalStats();
      renderTable();
      dom.refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Обновить';
      showNotification('Данные обновлены', 'success');
    });
    
    // Theme toggle
    dom.themeToggle.addEventListener('click', toggleTheme);
    
    // Filters
    dom.sortSelect.addEventListener('change', (e) => {
      state.sortBy = e.target.value;
      sortCoins();
      renderTable();
    });
    
    dom.currencySelect.addEventListener('change', (e) => {
      state.currency = e.target.value;
      renderTable();
    });
    
    dom.favoritesOnly.addEventListener('change', (e) => {
      state.favoritesOnly = e.target.checked;
      filterCoins();
      renderTable();
    });
    
    dom.hideStablecoins.addEventListener('change', (e) => {
      state.hideStablecoins = e.target.checked;
      filterCoins();
      renderTable();
    });
    
    // Pagination
    dom.prevPageBtn.addEventListener('click', () => {
      if (state.currentPage > 1) {
        state.currentPage--;
        renderTable();
      }
    });
    
    dom.nextPageBtn.addEventListener('click', () => {
      const totalPages = Math.ceil(state.filteredCoins.length / state.pageSize);
      if (state.currentPage < totalPages) {
        state.currentPage++;
        renderTable();
      }
    });
    
    dom.pageSizeSelect.addEventListener('change', (e) => {
      state.pageSize = parseInt(e.target.value);
      state.currentPage = 1;
      renderTable();
    });
    
    // Modal
    dom.modalCloseBtn.addEventListener('click', () => {
      dom.modalBackdrop.style.display = 'none';
      if (state.tvWidget) {
        state.tvWidget.remove();
        state.tvWidget = null;
      }
    });
    
    dom.modalBackdrop.addEventListener('click', (e) => {
      if (e.target === dom.modalBackdrop) {
        dom.modalBackdrop.style.display = 'none';
        if (state.tvWidget) {
          state.tvWidget.remove();
          state.tvWidget = null;
        }
      }
    });
    
    // News refresh
    dom.refreshNewsBtn.addEventListener('click', async () => {
      dom.refreshNewsBtn.classList.add('refreshing');
      await loadNews(true);
      dom.refreshNewsBtn.classList.remove('refreshing');
      showNotification('Новости обновлены', 'success');
    });
    
    // News alert close
    dom.newsAlertClose.addEventListener('click', () => {
      dom.newsAlert.classList.remove('show');
    });
    
    // About
    dom.aboutBtn.addEventListener('click', (e) => {
      e.preventDefault();
      showNotification('Crypto Pulse — панель мониторинга крипторынка с актуальными новостями', 'info');
    });
  }
  
  async function loadGlobalStats() {
    try {
      const response = await fetch('https://api.coingecko.com/api/v3/global');
      const data = await response.json();
      state.globalStats = data.data;
      
      // Update UI
      dom.totalMarketCap.textContent = formatCurrency(state.globalStats.total_market_cap.usd);
      dom.totalVolume.textContent = formatCurrency(state.globalStats.total_volume.usd);
      dom.btcDominance.textContent = state.globalStats.market_cap_percentage.btc.toFixed(1) + '%';
    } catch (error) {
      console.error('Error loading global stats:', error);
    }
  }
  
  async function loadCoinData() {
    try {
      const response = await fetch(
        `https://api.coingecko.com/api/v3/coins/markets?vs_currency=${state.currency}&order=market_cap_desc&per_page=250&page=1&sparkline=true&price_change_percentage=1h,24h,7d`
      );
      state.coins = await response.json();
      filterCoins();
      sortCoins();
    } catch (error) {
      console.error('Error loading coin data:', error);
      showNotification('Ошибка загрузки данных', 'error');
    }
  }
  
  async function loadNews(forceRefresh = false) {
    try {
      const now = Date.now();
      
      // Don't refresh too often unless forced
      if (!forceRefresh && now - state.lastNewsCheck < 60000) {
        return;
      }
      
      state.lastNewsCheck = now;
      dom.newsLoading.style.display = 'grid';
      dom.newsGrid.innerHTML = '';
      
      // In a real app, you would use a news API like:
      // 1. CryptoPanic API (https://cryptopanic.com/developers/api/)
      // 2. NewsAPI (https://newsapi.org/)
      // 3. GNews API
      
      // For demo purposes, we'll generate realistic crypto news
      const demoNews = generateDemoNews();
      
      // Check for new news
      if (state.news.length > 0) {
        const newNews = demoNews.filter(newNewsItem => 
          !state.news.some(existing => existing.id === newNewsItem.id)
        );
        
        if (newNews.length > 0) {
          // Add new news to the beginning
          state.news = [...newNews, ...state.news];
          
          // Mark as unseen
          newNews.forEach(news => state.unseenNews.add(news.id));
          
          // Update news count
          dom.newsCount.textContent = state.news.length;
        }
      } else {
        // First load
        state.news = demoNews;
        dom.newsCount.textContent = state.news.length;
      }
      
      // Keep only latest 12 news
      state.news = state.news.slice(0, 12);
      
      // Hide loading and render
      setTimeout(() => {
        dom.newsLoading.style.display = 'none';
        renderNews();
      }, 500);
      
    } catch (error) {
      console.error('Error loading news:', error);
      dom.newsLoading.style.display = 'none';
      dom.newsGrid.innerHTML = `
        <div class="news-empty">
          <i class="fas fa-exclamation-triangle"></i>
          <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Ошибка загрузки новостей</div>
          <div style="color: var(--muted);">Попробуйте обновить позже</div>
        </div>
      `;
    }
  }
  
  async function checkForNewNews() {
    try {
      // Generate new demo news (in real app would be API call)
      const newDemoNews = generateDemoNews(2); // Generate 2 new news
      
      // Filter out already existing news
      const trulyNewNews = newDemoNews.filter(newNewsItem => 
        !state.news.some(existing => existing.id === newNewsItem.id)
      );
      
      if (trulyNewNews.length > 0) {
        // Add to state
        state.news = [...trulyNewNews, ...state.news].slice(0, 12);
        
        // Mark as unseen
        trulyNewNews.forEach(news => state.unseenNews.add(news.id));
        
        // Update UI
        dom.newsCount.textContent = state.news.length;
        renderNews();
        
        return trulyNewNews;
      }
      
      return [];
    } catch (error) {
      console.error('Error checking for new news:', error);
      return [];
    }
  }
  
  function generateDemoNews(count = 12) {
    const titles = [
      "Биткоин достиг нового максимума в $75,000",
      "Ethereum готовится к обновлению Dencun",
      "Крупнейший хак DeFi-протокола за 2024 год",
      "ЦБ РФ обсуждает регулирование криптовалют",
      "Binance запускает новые торговые пары",
      "Рост интереса к DeFi 2.0",
      "NFT-рынок показывает признаки восстановления",
      "Криптовалютные ETF набирают популярность",
      "Майнинг биткоина становится экологичнее",
      "Стейкинг Ethereum приносит рекордную доходность",
      "Новый протокол Layer 2 привлекает $50M инвестиций",
      "Криптовалютные платежи в розничной торговле растут",
      "Смарт-контракты Cardano показывают рост",
      "Solana восстанавливается после сбоя сети",
      "Мемкоины снова в тренде"
    ];
    
    const descriptions = [
      "Крупнейшая криптовалюта по рыночной капитализации установила новый исторический максимум, преодолев психологически важный уровень.",
      "Разработчики Ethereum готовят масштабное обновление сети, которое должно снизить комиссии и увеличить пропускную способность.",
      "Неизвестные хакеры похитили более $100 миллионов из популярного DeFi-протокола, что стало крупнейшей кражей в этом году.",
      "Центральный банк России ведёт активные обсуждения по вопросам регулирования криптовалютного рынка в стране.",
      "Крупнейшая криптобиржа мира расширяет список доступных для торговли активов, добавляя новые перспективные токены.",
      "Поколение децентрализованных финансовых протоколов демонстрирует устойчивый рост и привлекает внимание институциональных инвесторов.",
      "После продолжительного спада рынок невзаимозаменяемых токенов показывает первые признаки восстановления.",
      "Инвестиционные фонды, ориентированные на криптовалюты, продолжают привлекать значительные средства от инвесторов.",
      "Благодаря внедрению возобновляемых источников энергии углеродный след майнинга биткоина значительно снизился.",
      "Владельцы Ethereum, участвующие в стейкинге, получают рекордную годовую доходность на свои вложения.",
      "Стартап в области масштабирования блокчейна привлёк значительные инвестиции от венчурных фондов.",
      "Всё больше розничных магазинов по всему миру начинают принимать криптовалюты в качестве средства оплаты.",
      "Количество активных смарт-контрактов в сети Cardano значительно выросло за последний квартал.",
      "Блокчейн Solana полностью восстановил работу после непродолжительного сбоя, вызванного высокой нагрузкой.",
      "Токены, созданные в шуточных целях, снова демонстрируют взрывной рост, привлекая внимание розничных инвесторов."
    ];
    
    const news = [];
    
    for (let i = 0; i < count; i++) {
      const source = newsSources[Math.floor(Math.random() * newsSources.length)];
      const isNew = i < 3; // First 3 are "new"
      const hoursAgo = Math.floor(Math.random() * 24);
      const minutesAgo = Math.floor(Math.random() * 60);
      
      const title = titles[Math.floor(Math.random() * titles.length)];
      const description = descriptions[Math.floor(Math.random() * descriptions.length)];
      
      // Determine tags based on content
      const tags = [];
      newsTopics.forEach(topic => {
        if (topic.keywords.some(keyword => 
          title.toLowerCase().includes(keyword) || 
          description.toLowerCase().includes(keyword)
        )) {
          tags.push(topic.tag);
        }
      });
      
      // If no tags matched, add random ones
      if (tags.length === 0) {
        const randomTags = ['bitcoin', 'ethereum', 'defi', 'regulation'];
        tags.push(randomTags[Math.floor(Math.random() * randomTags.length)]);
      }
      
      // Generate unique ID
      const id = `news-${Date.now()}-${i}`;
      
      news.push({
        id,
        title,
        description,
        source,
        image: `https://images.unsplash.com/photo-${1621970000000 + i * 100000}?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80`,
        time: hoursAgo > 0 ? `${hoursAgo} ч назад` : `${minutesAgo} мин назад`,
        tags,
        isNew,
        url: `https://example.com/news/${id}`
      });
    }
    
    return news;
  }
  
  function renderNews() {
    if (state.news.length === 0) {
      dom.newsGrid.innerHTML = `
        <div class="news-empty">
          <i class="fas fa-newspaper"></i>
          <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Новости не найдены</div>
          <div style="color: var(--muted);">Попробуйте обновить позже</div>
        </div>
      `;
      return;
    }
    
    dom.newsGrid.innerHTML = state.news.map((news, index) => {
      const isUnseen = state.unseenNews.has(news.id);
      const tagClass = news.tags[0] || 'bitcoin';
      
      return `
        <div class="news-card ${isUnseen ? 'new' : ''} animate-in" data-news-id="${news.id}" style="animation-delay: ${index * 0.1}s">
          <img src="${news.image}" alt="${news.title}" class="news-image">
          <div class="news-content">
            <div class="news-source">
              <img src="${news.source.logo}" alt="${news.source.name}" class="source-logo">
              <span class="source-name">${news.source.name}</span>
              <span class="news-time">${news.time}</span>
            </div>
            <h3 class="news-title-text">${news.title}</h3>
            <p class="news-description">${news.description}</p>
            <div class="news-tags">
              ${news.tags.slice(0, 2).map(tag => `
                <span class="news-tag ${tag}">${getTagName(tag)}</span>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }).join('');
    
    // Add click listeners
    document.querySelectorAll('.news-card').forEach(card => {
      card.addEventListener('click', (e) => {
        const newsId = card.getAttribute('data-news-id');
        const news = state.news.find(n => n.id === newsId);
        if (news) {
          // Mark as seen
          state.unseenNews.delete(news.id);
          card.classList.remove('new');
          
          // Open in new tab (in real app would open modal or redirect)
          window.open(news.url, '_blank');
        }
      });
    });
  }
  
  function showNewsAlert(news) {
    dom.newsAlertTitle.textContent = news.title;
    dom.newsAlertSource.textContent = `${news.source.name} • ${news.time}`;
    
    // Show alert
    dom.newsAlert.classList.add('show');
    
    // Auto hide after 10 seconds
    setTimeout(() => {
      if (dom.newsAlert.classList.contains('show')) {
        dom.newsAlert.classList.remove('show');
      }
    }, 10000);
    
    // Pulse live badge
    dom.liveNewsBadge.style.animation = 'pulse 0.5s 3';
    setTimeout(() => {
      dom.liveNewsBadge.style.animation = 'pulse 2s infinite';
    }, 1500);
  }
  
  function getTagName(tag) {
    const tagMap = {
      'bitcoin': 'Bitcoin',
      'ethereum': 'Ethereum',
      'defi': 'DeFi',
      'nft': 'NFT',
      'regulation': 'Регулирование',
      'exchange': 'Биржи',
      'mining': 'Майнинг',
      'wallet': 'Кошельки'
    };
    
    return tagMap[tag] || tag;
  }
  
  function filterCoins() {
    state.filteredCoins = state.coins.filter(coin => {
      // Search filter
      if (state.searchQuery) {
        const query = state.searchQuery.toLowerCase();
        if (!coin.name.toLowerCase().includes(query) && !coin.symbol.toLowerCase().includes(query)) {
          return false;
        }
      }
      
      // Favorites filter
      if (state.favoritesOnly && !state.favorites.has(coin.id)) {
        return false;
      }
      
      // Stablecoins filter
      if (state.hideStablecoins && coin.symbol.toLowerCase().includes('usd')) {
        return false;
      }
      
      return true;
    });
  }
  
  function sortCoins() {
    const [field, direction] = state.sortBy.split('_');
    
    state.filteredCoins.sort((a, b) => {
      let valueA, valueB;
      
      switch(field) {
        case 'market':
          valueA = a.market_cap;
          valueB = b.market_cap;
          break;
        case 'volume':
          valueA = a.total_volume;
          valueB = b.total_volume;
          break;
        case 'price':
          valueA = a.current_price;
          valueB = b.current_price;
          break;
        case 'change':
          valueA = a.price_change_percentage_24h || 0;
          valueB = b.price_change_percentage_24h || 0;
          break;
        default:
          valueA = a.market_cap;
          valueB = b.market_cap;
      }
      
      if (direction === 'desc') {
        return valueB - valueA;
      } else {
        return valueA - valueB;
      }
    });
  }
  
  function renderTable() {
    const startIndex = (state.currentPage - 1) * state.pageSize;
    const endIndex = startIndex + state.pageSize;
    const coinsToShow = state.filteredCoins.slice(startIndex, endIndex);
    
    // Update pagination info
    dom.showingCount.textContent = `${startIndex + 1}-${Math.min(endIndex, state.filteredCoins.length)}`;
    dom.totalCount.textContent = state.filteredCoins.length;
    
    // Update pagination buttons
    dom.prevPageBtn.disabled = state.currentPage === 1;
    dom.nextPageBtn.disabled = endIndex >= state.filteredCoins.length;
    
    // Render coins
    dom.tableBody.innerHTML = coinsToShow.map((coin, index) => {
      const rank = startIndex + index + 1;
      const isFavorite = state.favorites.has(coin.id);
      const changeClass = coin.price_change_percentage_24h >= 0 ? 'change-up' : 'change-down';
      const changeIcon = coin.price_change_percentage_24h >= 0 ? '▲' : '▼';
      
      // Prepare sparkline data
      const sparklineId = `sparkline-${coin.id}`;
      
      return `
        <div class="table-row animate-in" data-coin-id="${coin.id}">
          <div style="font-weight: 700; color: var(--muted);">${rank}</div>
          
          <div class="coin-cell">
            <div class="coin-icon">
              <img src="${coin.image}" alt="${coin.name}">
            </div>
            <div class="coin-info">
              <div class="coin-name">${coin.name}</div>
              <div class="coin-symbol">${coin.symbol.toUpperCase()}</div>
            </div>
          </div>
          
          <div class="price-cell">${formatCurrency(coin.current_price)}</div>
          
          <div class="change-cell ${changeClass}">
            ${changeIcon} ${Math.abs(coin.price_change_percentage_24h || 0).toFixed(2)}%
          </div>
          
          <div class="market-cap-cell">${formatCurrency(coin.market_cap)}</div>
          
          <div class="volume-cell">${formatCurrency(coin.total_volume)}</div>
          
          <div class="sparkline-container" id="${sparklineId}">
            <canvas class="sparkline-canvas" width="180" height="50"></canvas>
            <div class="sparkline-overlay">
              <div class="sparkline-stats">
                <div class="sparkline-period">7 ДНЕЙ</div>
                <div class="sparkline-change ${coin.price_change_percentage_7d_in_currency >= 0 ? 'change-up' : 'change-down'}">
                  ${coin.price_change_percentage_7d_in_currency >= 0 ? '+' : ''}${coin.price_change_percentage_7d_in_currency?.toFixed(2) || '0.00'}%
                </div>
              </div>
            </div>
          </div>
          
          <div class="badge-cell">
            ${coin.symbol.toUpperCase().includes('USD') ? '<span class="badge">СТЕЙБЛ</span>' : ''}
            ${coin.market_cap_rank <= 10 ? '<span class="badge">ТОП-10</span>' : ''}
            ${coin.market_cap_rank <= 50 ? '<span class="badge">ТОП-50</span>' : ''}
          </div>
          
          <div class="favorite-cell">
            <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-coin-id="${coin.id}">
              <i class="fas fa-star"></i>
            </button>
          </div>
        </div>
      `;
    }).join('');
    
    // Add event listeners to new elements
    coinsToShow.forEach(coin => {
      // Sparkline click
      const sparklineContainer = document.getElementById(`sparkline-${coin.id}`);
      if (sparklineContainer) {
        sparklineContainer.addEventListener('click', () => openCoinModal(coin));
        
        // Draw sparkline
        setTimeout(() => drawSparkline(coin), 100);
      }
      
      // Row click
      const row = document.querySelector(`[data-coin-id="${coin.id}"]`);
      if (row) {
        row.addEventListener('click', (e) => {
          if (!e.target.closest('.favorite-btn') && !e.target.closest('.sparkline-container')) {
            openCoinModal(coin);
          }
        });
      }
      
      // Favorite button
      const favoriteBtn = document.querySelector(`[data-coin-id="${coin.id}"] .favorite-btn`);
      if (favoriteBtn) {
        favoriteBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          toggleFavorite(coin.id);
        });
      }
    });
  }
  
  function drawSparkline(coin) {
    const canvas = document.querySelector(`#sparkline-${coin.id} canvas`);
    if (!canvas || !coin.sparkline_in_7d?.price) return;
    
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    const data = coin.sparkline_in_7d.price;
    
    // Clear canvas
    ctx.clearRect(0, 0, width, height);
    
    // Calculate min and max
    const min = Math.min(...data);
    const max = Math.max(...data);
    const range = max - min;
    
    // Set line color
    const isPositive = data[data.length - 1] >= data[0];
    ctx.strokeStyle = isPositive ? getComputedStyle(document.body).getPropertyValue('--green') : 
                                   getComputedStyle(document.body).getPropertyValue('--red');
    ctx.lineWidth = 2;
    ctx.lineJoin = 'round';
    ctx.lineCap = 'round';
    
    // Draw line
    ctx.beginPath();
    data.forEach((value, index) => {
      const x = (index / (data.length - 1)) * width;
      const y = height - ((value - min) / range) * height * 0.8 - height * 0.1;
      
      if (index === 0) {
        ctx.moveTo(x, y);
      } else {
        ctx.lineTo(x, y);
      }
    });
    ctx.stroke();
    
    // Draw gradient fill
    const gradient = ctx.createLinearGradient(0, 0, 0, height);
    gradient.addColorStop(0, isPositive ? 
      'rgba(46, 213, 115, 0.2)' : 'rgba(255, 71, 87, 0.2)');
    gradient.addColorStop(1, 'transparent');
    
    ctx.fillStyle = gradient;
    ctx.lineTo(width, height);
    ctx.lineTo(0, height);
    ctx.closePath();
    ctx.fill();
  }
  
  function openCoinModal(coin) {
    // Update modal content
    dom.modalCoinIcon.src = coin.image;
    dom.modalCoinName.textContent = coin.name;
    dom.modalCoinSymbol.textContent = `(${coin.symbol.toUpperCase()})`;
    dom.modalCurrentPrice.textContent = formatCurrency(coin.current_price);
    dom.modal24hChange.textContent = `${coin.price_change_percentage_24h >= 0 ? '+' : ''}${coin.price_change_percentage_24h?.toFixed(2) || '0.00'}%`;
    dom.modal24hChange.className = `modal-stat-value ${coin.price_change_percentage_24h >= 0 ? 'change-up' : 'change-down'}`;
    dom.modalMarketCap.textContent = formatCurrency(coin.market_cap);
    dom.modalVolume.textContent = formatCurrency(coin.total_volume);
    dom.modalSupply.textContent = `${(coin.circulating_supply || 0).toLocaleString()} ${coin.symbol.toUpperCase()}`;
    dom.modalRank.textContent = `#${coin.market_cap_rank}`;
    
    // Show modal
    dom.modalBackdrop.style.display = 'flex';
    
    // Load TradingView chart
    setTimeout(() => loadTradingViewChart(coin.symbol), 100);
  }
  
  function loadTradingViewChart(symbol) {
    // Clear previous chart
    dom.modalChartContainer.innerHTML = '';
    
    // Create new chart
    if (typeof TradingView !== 'undefined') {
      state.tvWidget = new TradingView.widget({
        container_id: 'modalChartContainer',
        width: '100%',
        height: 400,
        symbol: getTradingViewSymbol(symbol),
        interval: 'D',
        timezone: 'Etc/UTC',
        theme: state.theme,
        style: '1',
        locale: 'ru',
        toolbar_bg: '#f1f3f6',
        enable_publishing: false,
        hide_side_toolbar: false,
        allow_symbol_change: true,
        details: true,
        studies: [
          'MACD@tv-basicstudies',
          'RSI@tv-basicstudies',
          'Volume@tv-basicstudies'
        ],
        show_popup_button: true,
        popup_width: '1000',
        popup_height: '650',
      });
    }
  }
  
  function getTradingViewSymbol(symbol) {
    const symbolMap = {
      'btc': 'BINANCE:BTCUSDT',
      'eth': 'BINANCE:ETHUSDT',
      'bnb': 'BINANCE:BNBUSDT',
      'sol': 'BINANCE:SOLUSDT',
      'xrp': 'BINANCE:XRPUSDT',
      'ada': 'BINANCE:ADAUSDT',
      'doge': 'BINANCE:DOGEUSDT',
      'dot': 'BINANCE:DOTUSDT',
      'matic': 'BINANCE:MATICUSDT',
      'shib': 'BINANCE:SHIBUSDT'
    };
    
    return symbolMap[symbol.toLowerCase()] || `BINANCE:${symbol.toUpperCase()}USDT`;
  }
  
  function toggleFavorite(coinId) {
    if (state.favorites.has(coinId)) {
      state.favorites.delete(coinId);
      showNotification('Удалено из избранного', 'info');
    } else {
      state.favorites.add(coinId);
      showNotification('Добавлено в избранное', 'success');
    }
    
    // Save to localStorage
    localStorage.setItem('cryptoFavorites', JSON.stringify([...state.favorites]));
    
    // Update UI
    renderTable();
  }
  
  function toggleTheme() {
    const newTheme = state.theme === 'dark' ? 'light' : 'dark';
    state.theme = newTheme;
    document.body.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    dom.themeToggle.innerHTML = newTheme === 'dark' ? 
      '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
    
    // Update TradingView chart if open
    if (dom.modalBackdrop.style.display === 'flex' && state.tvWidget) {
      setTimeout(() => {
        if (state.tvWidget) {
          state.tvWidget.remove();
          state.tvWidget = null;
          const currentCoin = document.querySelector('.table-row:hover')?.getAttribute('data-coin-id');
          if (currentCoin) {
            const coin = state.coins.find(c => c.id === currentCoin);
            if (coin) loadTradingViewChart(coin.symbol);
          }
        }
      }, 300);
    }
  }
  
  function handleSearch(e) {
    state.searchQuery = e.target.value;
    state.currentPage = 1;
    filterCoins();
    renderTable();
    
    // Show search results dropdown
    if (state.searchQuery.trim()) {
      showSearchResults();
    } else {
      dom.searchResults.style.display = 'none';
    }
  }
  
  function showSearchResults() {
    const results = state.coins
      .filter(coin => 
        coin.name.toLowerCase().includes(state.searchQuery.toLowerCase()) ||
        coin.symbol.toLowerCase().includes(state.searchQuery.toLowerCase())
      )
      .slice(0, 8);
    
    if (results.length > 0) {
      dom.searchResults.innerHTML = results.map(coin => `
        <div class="search-result" data-coin-id="${coin.id}">
          <img src="${coin.image}" alt="${coin.name}" class="search-result-icon">
          <div>
            <div style="font-weight: 600;">${coin.name}</div>
            <div style="font-size: 12px; color: var(--muted);">${coin.symbol.toUpperCase()}</div>
          </div>
          <div style="margin-left: auto; font-weight: 700;">${formatCurrency(coin.current_price)}</div>
        </div>
      `).join('');
      
      dom.searchResults.style.display = 'block';
      
      // Add click listeners
      dom.searchResults.querySelectorAll('.search-result').forEach(result => {
        result.addEventListener('click', () => {
          const coinId = result.getAttribute('data-coin-id');
          const coin = state.coins.find(c => c.id === coinId);
          if (coin) {
            openCoinModal(coin);
            dom.searchResults.style.display = 'none';
            dom.searchInput.value = '';
            state.searchQuery = '';
          }
        });
      });
    } else {
      dom.searchResults.innerHTML = `
        <div class="search-result">
          <div style="padding: 20px; text-align: center; color: var(--muted);">
            Ничего не найдено
          </div>
        </div>
      `;
      dom.searchResults.style.display = 'block';
    }
  }
  
  // Utility functions
  function formatCurrency(value) {
    if (value >= 1e12) {
      return '$' + (value / 1e12).toFixed(2) + 'T';
    } else if (value >= 1e9) {
      return '$' + (value / 1e9).toFixed(2) + 'B';
    } else if (value >= 1e6) {
      return '$' + (value / 1e6).toFixed(2) + 'M';
    } else if (value >= 1e3) {
      return '$' + (value / 1e3).toFixed(2) + 'K';
    } else if (value >= 1) {
      return '$' + value.toFixed(2);
    } else if (value >= 0.01) {
      return '$' + value.toFixed(4);
    } else {
      return '$' + value.toFixed(8);
    }
  }
  
  function showNotification(message, type = 'success') {
    const notification = dom.notification;
    notification.className = `notification notification-${type}`;
    notification.querySelector('.notification-icon').textContent = type === 'success' ? '✓' : '!';
    notification.querySelector('.notification-message').textContent = message;
    
    notification.classList.add('show');
    
    setTimeout(() => {
      notification.classList.remove('show');
    }, 3000);
  }
  
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }
})();
</script>
</body>
</html>
